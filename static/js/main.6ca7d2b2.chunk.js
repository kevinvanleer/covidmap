(this.webpackJsonpcovidmap=this.webpackJsonpcovidmap||[]).push([[0],{104:function(e,t,a){e.exports=a(126)},109:function(e,t,a){},126:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(11),o=a.n(c),s=(a(109),a(15)),i=a(12),u=a(6),l=a(4),d=a.n(l),f=a(2),m=a(1),p=a(20),b=a(9);function h(){var e=Object(p.a)(["\n  color: ",";\n  text-decoration: none;\n\n  &:visited {\n    color: ",";\n  }\n\n  &:hover {\n    color: cyan;\n  }\n\n  &:active {\n    color: #1790a7;\n  }\n\n  &:focus {\n    color: cyan;\n  }\n"]);return h=function(){return e},e}var y=b.a.a(h(),(function(e){return e.color}),(function(e){return e.color}));y.defaultProps={color:"#38c9e4"};var v=function(e){var t=e.onHide;return r.a.createElement(m.c,{flexDirection:"column",backgroundColor:"#444",color:"#eee",padding:"1em",maxWidth:"80ch",margin:"1em"},r.a.createElement(m.f,{fontSize:"heading"},"About this visualization"),r.a.createElement(m.d,{height:"0.5em"}),r.a.createElement(m.f,null,"COVID-19 cases and deaths are displayed as blue and red choropleths as reported by the New York Times. Onset, the date of the first case in each county are represented by green icons. Hotspots are displays as red icons. The geographic visuals are rendered with MapBox. The charts are built with D3."),r.a.createElement(m.d,{height:"1em"}),r.a.createElement(m.f,{fontSize:"label"},"Statistics explained"),r.a.createElement(m.d,{height:"0.2em"}),r.a.createElement(m.f,null,"Hotspots are those counties that have at least 100 cases and in which total cases have increased 20% in the past two weeks."),r.a.createElement(m.d,{height:"0.3em"}),r.a.createElement(m.f,null,"New cases are those reported on most recent day for the county, typically yesterday."),r.a.createElement(m.d,{height:"0.3em"}),r.a.createElement(m.f,null,"Ongoing cases is an estimate represented by cases reported within the past two weeks."),r.a.createElement(m.d,{height:"0.3em"}),r.a.createElement(m.f,null,"Death rate compares the current number of deaths to the total number of cases two weeks prior."),r.a.createElement(m.d,{height:"1em"}),r.a.createElement(m.f,{fontSize:"label"},"Data sources"),r.a.createElement(m.d,{height:"0.5em"}),r.a.createElement(m.f,null,"US 2010 census county boundaries"),r.a.createElement(y,{href:"https://eric.clst.org/tech/usgeojson/"},r.a.createElement(m.f,{fontSize:"detail"},"https://eric.clst.org/tech/usgeojson/")),r.a.createElement(m.d,{height:"0.5em"}),r.a.createElement(m.f,null,"New York Times COVID-19 US county-level historic data"),r.a.createElement(y,{href:"https://github.com/nytimes/covid-19-data"},r.a.createElement(m.f,{fontSize:"detail"},"https://github.com/nytimes/covid-19-data")),r.a.createElement(m.d,{height:"0.5em"}),r.a.createElement(m.f,null,"Source code"),r.a.createElement(y,{href:"https://github.com/kevinvanleer/covidmap"},r.a.createElement(m.f,{fontSize:"detail"},"https://github.com/kevinvanleer/covidmap")),r.a.createElement(y,{href:"https://github.com/kevinvanleer/coviddata"},r.a.createElement(m.f,{fontSize:"detail"},"https://github.com/kevinvanleer/coviddata")),r.a.createElement(m.d,{height:"0.5em"}),r.a.createElement(m.f,{fontSize:"detail"},"Assembled by Kevin Van Leer. Feedback welcome at:"),r.a.createElement(y,{href:"mailto:kevin.vanleer@gmail.com"},"kevin.vanleer@gmail.com"),r.a.createElement(m.d,{height:"1em"}),r.a.createElement(m.a,{id:"covidmap-about-hide-self",onClick:t},r.a.createElement(m.f,{color:"#eee"},"Dismiss")))},g=a(13),j=a(8);function E(){var e=Object(p.a)(["\n  position: absolute;\n"]);return E=function(){return e},e}var O=Object(b.a)(m.c)(E());O.defaultProps={zIndex:10,flexDirection:"column",backgroundColor:"#444",color:"#eee",padding:"1em"};var k=function(e){var t=e.id,a=e.onClick,n=e.icon,c=e.active;return r.a.createElement(m.e,{id:t,onClick:a,backgroundColor:c?"#777":"#333"},r.a.createElement(g.a,{icon:n,color:c?"#eee":"#777",fixedWidth:!0}))},x=function(e){var t=e.layers,a=e.activeLayers,c=e.updateActiveLayers,o=e.detailsData,s=e.onShowAbout,u=e.onSetDate,l=e.date,f=Object(n.useState)(!1),p=Object(i.a)(f,2),b=p[0],h=p[1],y=Object(n.useState)(!1),v=Object(i.a)(y,2),E=v[0],x=v[1],w=Object(n.useState)(!1),C=Object(i.a)(w,2),S=C[0],D=C[1];return r.a.createElement(O,{width:"min-content",right:"1em",top:"1em",backgroundColor:"rgba(68,68,68,0.85)",zIndex:100},r.a.createElement(m.c,{alignItems:"center"},r.a.createElement(m.f,{nowrap:!0,fontSize:"heading"},"COVID-19"),r.a.createElement(m.d,{width:"1em",flexGrow:1}),r.a.createElement(m.c,{marginBetween:"0.2em",alignItems:"center"},r.a.createElement(k,{id:"button-covidmap-control-panel-hide-layers",flexGrow:0,onClick:function(){return x(!E)},icon:j.e,active:!E,backgroundColor:"#777"}),r.a.createElement(k,{id:"button-covidmap-control-panel-hide-details",flexGrow:0,onClick:function(){return D(!S)},icon:j.a,active:!S,backgroundColor:"#777"}),r.a.createElement(K,{id:"button-covidmap-control-panel-collapse",flexGrow:0,color:"white",onClick:function(){return h(!b)},collapsed:b,backgroundColor:"#777"}))),r.a.createElement(m.b,{horizontal:!0,margin:"0.5em 0"}),E?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(Z,{layers:t,activeLayers:a,updateActiveLayers:c,collapsed:b}),r.a.createElement(m.b,{horizontal:!0,margin:"1em 0 0.5em 0"})),S?null:r.a.createElement(V,{date:d()(l),entity:o,collapsed:b}),r.a.createElement(M,{date:l,setDate:u,withChart:!S}),r.a.createElement(m.c,null,r.a.createElement(m.d,{flexGrow:1}),b?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(m.d,{height:"1em"}),r.a.createElement(m.e,{id:"covidmap-show-about-box",onClick:s,backgroundColor:"#777"},r.a.createElement(g.a,{color:"#eee",icon:j.d})))))},w=a(56),C=(a(124),a(7)),S=Object(C.b)("time/updateCurrentTime",(function(e,t){var a=e.timestamp,n=e.previous,r=t.dispatch,c=(0,t.getState)().core.time,o=100;c.pause||(o=0,n||(n=a),r(z(a-n))),window.requestAnimationFrame((function(e){return setTimeout((function(){return r(S(e,a))}),o)}))})),D=(Object(C.b)("time/startPlayback",(function(e){var t=e.dispatch;return window.requestAnimationFrame((function(e){return t(S(e))}))})),Object(C.c)({name:"time",initialState:{min:parseInt(d()("2020-01-01").format("x")),max:parseInt(d()().subtract(1,"days").format("x")),current:parseInt(d()().subtract(1,"days").format("x")),pause:!0,rate:0},reducers:{setCurrent:function(e,t){e.current=parseInt(t.payload)},tick:function(e,t){var a;e.current>=e.max?a=e.min:(a=e.current+t.payload*e.rate)>e.max&&(a=e.max),e.current=a},togglePlayPause:function(e,t){e.pause=!e.pause,e.rate=e.pause?0:864e3},setMax:function(e,t){e.max=t.payload},setMin:function(e,t){e.min=t.payload},setRate:function(e,t){e.rate=t.payload},setPause:function(e,t){e.pause=t.pause}}})),I=D.actions,Y=I.setCurrent,z=I.tick,B=(I.setMax,I.setMin,I.setRate,I.setPause,I.togglePlayPause),F=D.reducer,M=function(e){e.date;var t=e.setDate,a=e.withChart,n=Object(u.b)(),c=Object(u.c)((function(e){return e.core.time}));return r.a.createElement(m.c,{margin:a?"0 0 0 30px":"0",flexDirection:"column"},r.a.createElement(w.a,{min:c.min,max:c.max,onChange:function(e){t(e)},value:c.current}),r.a.createElement(m.c,null,r.a.createElement(m.e,{id:"button-legend-play-pause",onClick:function(){return n(B())},backgroundColor:"#777"},r.a.createElement(g.a,{color:"#eee",icon:0===c.rate?j.h:j.g})),r.a.createElement(m.d,{flexGrow:1}),r.a.createElement(m.f,null,d()(c.current,"x").format("YYYY-MM-DD"))))},L=function(e){var t=e.collapsed,a=(e.entity,e.deathRate),n=e.recentData,c=e.newCases,o=e.ongoingCases;return t?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(m.f,null,"Total cases: ".concat(new Intl.NumberFormat("en-US").format(Object(f.get)(n,"cases",0)))),r.a.createElement(m.f,null,"Total deaths: ".concat(new Intl.NumberFormat("en-US").format(Object(f.get)(n,"deaths",0)))),r.a.createElement(m.f,null,"New cases: ".concat(new Intl.NumberFormat("en-US").format(c))),r.a.createElement(m.f,null,"Ongoing cases: ".concat(new Intl.NumberFormat("en-US").format(o))),r.a.createElement(m.f,null,"Death rate: ".concat((100*a.twoWeek).toFixed(),"%")))},A=a(16),N=function(e){var t=e.height,a=e.data,c=e.currentDate,o=e.currentValue,s=e.showIntercept,i=Object(n.useRef)(null),u=.035*t,l=Object.assign(a.slice(1).map((function(e){var t=e.date,a=e.cases,n=e.deaths;return{date:d()(t),cases:a,deaths:n}})),{y:"Cases"});return Object(n.useEffect)((function(){var e=20,n=0,r=30,m=30;if(a&&i.current){var p=A.g(i.current);p.selectAll("*").remove();var b=A.f().domain([d()("2020-01-01","YYYY-MM-DD"),d()().subtract(1,"days")]).range([m,300-n]),h=A.e().domain([0,Math.max(Object(f.get)(Object(f.last)(l),"cases",0),10)]).nice().range([t-r,e]),y=A.d,v=A.a().curve(y).x((function(e){return b(e.date)})).y0(h(0)).y1((function(e){return h(e.cases)})),g=A.a().curve(y).x((function(e){return b(e.date)})).y0(h(0)).y1((function(e){return h(e.deaths)}));p.append("path").datum(l).attr("fill","steelblue").attr("d",v),p.append("path").datum(l).attr("fill","red").attr("d",g),p.append("g").call((function(e){return e.attr("transform","translate(0,".concat(t-r,")")).call(A.b(b).ticks(5).tickFormat(A.h("%b")).tickSizeOuter(0))})),p.append("g").call((function(e){return e.attr("transform","translate(".concat(m,",0)")).call(A.c(h).ticks(u,"s")).call((function(e){return e.select(".domain").remove()})).call((function(e){return e.select(".tick:last-of-type text").clone().attr("x",3).attr("text-anchor","start").attr("font-weight","bold").text(l.y)}))}));Object(f.isEmpty)(a)||(p.append("line").attr("x1",b(c)).attr("x2",b(c)).attr("y1",t-r).attr("y2",h(o)+2).style("stroke-width",1).style("stroke","#ccc").style("fill","none"),p.append("circle").attr("cx",b(c)).attr("cy",h(o)).attr("r",2).style("stroke-width",1).style("stroke","#ccc").style("fill","none")),s&&l[0]&&(p.append("line").attr("x1",b(l[0].date)).attr("x2",b(l[0].date)).attr("y1",t-r).attr("y2",t/2).style("stroke-width",1).style("stroke","#ccc").style("fill","none"),p.append("text").attr("x",b(l[0].date)).attr("y",t/2-5).text(l[0].date.format("MMM D")).attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size","10px").attr("fill","#eee")),Object(f.isEmpty)(a)&&p.append("text").attr("x",150).attr("y",t/2).text("No data").attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size","20px").attr("fill","#eee")}}),[a,l,t,u,c,o,s]),r.a.createElement("svg",{className:"area-chart-container",width:300,height:t,role:"img",ref:i,pointerEvents:"none"})};N.defaultProps={height:200,data:[],currentValue:0};var P=N,T=Object(C.c)({name:"map",initialState:{hold:!1,selectedFeature:null},reducers:{hold:function(e){e.hold=!0},releaseHold:function(e){e.hold=!1},setHold:function(e,t){e.hold=t.payload},setSelectedFeature:function(e,t){e.selectedFeature=t.payload}}}),W=T.actions,R=W.setHold,q=(W.hold,W.releaseHold),U=W.setSelectedFeature,H=T.reducer,V=function(e){var t=e.date,a=e.entity,c=e.collapsed,o=Object(u.b)(),s=Object(u.c)((function(e){return e.ui.map.selectedFeature})),i=a.data,l=null,p={},b=0,h=0;if(Object(f.isEmpty)(i))l={date:"2020-01-01",cases:0,deaths:0},p={current:0,twoWeek:0,fourWeek:0,eightWeek:0};else{l=Object(f.findLast)(i,(function(e){return e.date<=t.format("YYYY-MM-DD")}))||{deaths:0,cases:0};var y=Object(f.findLast)(i,(function(e){return e.date<=d()(t).subtract(1,"days").format("YYYY-MM-DD")})),v=Object(f.findLast)(i,(function(e){return e.date<=d()(t).subtract(2,"weeks").format("YYYY-MM-DD")})),E=Object(f.findLast)(i,(function(e){return e.date<=d()(t).subtract(4,"weeks").format("YYYY-MM-DD")})),O=Object(f.findLast)(i,(function(e){return e.date<=d()(t).subtract(8,"weeks").format("YYYY-MM-DD")}));Object(f.set)(p,"current",l.deaths/l.cases),Object(f.set)(p,"twoWeek",l.deaths/Object(f.get)(v,"cases")||0),Object(f.set)(p,"fourWeek",l.deaths/Object(f.get)(E,"cases")||0),Object(f.set)(p,"eightWeek",l.deaths/Object(f.get)(O,"cases")||0),b=Object(f.get)(l,"cases",0)-Object(f.get)(y,"cases",0),h=Object(f.get)(l,"cases",0)-Object(f.get)(v,"cases",0)}var k=Object(n.useCallback)((function(){o(q()),o(U(null))}),[o]);return l?r.a.createElement(m.c,{flexDirection:"column"},r.a.createElement(m.c,{inline:!0},r.a.createElement(m.c,{flexDirection:"column"},r.a.createElement(m.f,{bold:!0,fontSize:"label"},a.displayName),r.a.createElement(m.f,{fontSize:"detail"},"reporting on ".concat(l.date)),r.a.createElement(m.d,{height:"0.5em"}),r.a.createElement(L,{deathRate:p,collapsed:c,entity:a,recentData:l,newCases:b,ongoingCases:h})),r.a.createElement(m.d,{flexGrow:1}),null!=s?r.a.createElement(m.e,{id:"covid19-button-close-stats",onClick:k,backgroundColor:"#777"},r.a.createElement(g.a,{color:"#eee",icon:j.b,fixedWidth:!0})):null),r.a.createElement(P,{data:i,currentDate:t,height:c?100:void 0,currentValue:parseInt(Object(f.get)(l,"cases",0)),showIntercept:!0})):null};function G(){var e=Object(p.a)(["\n  cursor: pointer;\n"]);return G=function(){return e},e}var J=Object(b.a)((function(e){var t=e.className,a=e.onClick,n=e.config,c=e.active,o=e.collapsed;return r.a.createElement(m.c,{alignItems:"center",onClick:a},r.a.createElement(m.e,{id:"covidmap-button-layer-item-".concat(n.label.toLowerCase()),onClick:a,backgroundColor:c?"#777":"#333"},r.a.createElement(g.a,{size:o?"sm":"lg",icon:n.icon,color:c?"#eee":"#777",fixedWidth:!0})),o?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(m.d,{width:"0.5em"}),r.a.createElement(m.f,{fontSize:"label",bold:c,className:t},n.label)))}))(G()),Z=function(e){var t=e.layers,a=e.activeLayers,n=e.updateActiveLayers,c=e.collapsed;return r.a.createElement(m.c,{flexDirection:"column"},c?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(m.f,{bold:!0,fontSize:"label"},"Layers"),r.a.createElement(m.d,{height:"0.5em"})),r.a.createElement(m.c,{flexWrap:"wrap",wrapMargin:"0.5em"},t.map((function(e){return void 0===e.legend?null:r.a.createElement(J,{key:e.id,onClick:function(){return n(e.id)},config:e.legend,active:a.includes(e.id),collapsed:c})}))))},_=a(34),K=function(e){var t=e.collapsed,a=Object(_.a)(e,["collapsed"]);return r.a.createElement(m.e,a,r.a.createElement(g.a,{color:"#eee",icon:t?j.i:j.f,fixedWidth:!0}))},X=function(e){var t=e.status;return r.a.createElement(m.c,{backgroundColor:"#222",position:"absolute",top:"0",bottom:"0",left:"0",right:"0"},r.a.createElement(m.f,{position:"absolute",margin:"0 auto",top:"50%",zIndex:100,width:"100%",centerAlign:!0,fontSize:"title",color:"#eee"},t.error?"API server failed to respond":"Waiting for API server to wake up..."))},Q=a(10),$=a.n(Q),ee=a(18),te=a(57),ae=Object(C.c)({name:"usCovidData",initialState:{totals:[],casesByCounty:{},badRecords:[]},reducers:{load:function(e,t){e.casesByCounty=t.payload},addBoundaries:function(e,t){e.casesByCounty=Object(te.a)({},e.casesByCounty,{},t.payload)},addBoundary:function(e,t){var a=t.payload;e.casesByCounty[parseInt(a.properties.FEATURE_ID)]=[{date:"2020-01-01",cases:0,deaths:0,county:a.properties.NAME,state:a.properties.STATE}]},insertStatus:function(e,t){Object.entries(t.payload).forEach((function(t){var a=Object(i.a)(t,2),n=a[0],r=a[1];n in e.casesByCounty?e.casesByCounty[n]=[e.casesByCounty[n][0]].concat(Object(s.a)(r),Object(s.a)(e.casesByCounty[n].slice(1))):e.casesByCounty[n]=r}))},appendStatus:function(e,t){Object.entries(t.payload).forEach((function(t){var a=Object(i.a)(t,2),n=a[0],r=a[1];n in e.casesByCounty?e.casesByCounty[n]=[].concat(Object(s.a)(e.casesByCounty[n]),Object(s.a)(r)):e.casesByCounty[n]=r}))},appendBadRecords:function(e,t){e.badRecords=t.payload},setTotals:function(e,t){e.totals=t.payload.data}}}),ne=ae.actions,re=(ne.load,ne.appendStatus,ne.insertStatus),ce=ne.appendBadRecords,oe=(ne.addBoundary,ne.addBoundaries),se=ne.setTotals,ie=ae.reducer,ue=Object(C.c)({name:"apiServerStatus",initialState:{aliveCheck:{pending:null,error:null,complete:null,success:null,result:null,object:null}},reducers:{aliveCheckPending:function(e){e.aliveCheck={pending:!0,error:null,complete:!1,success:null,result:null,object:null}},aliveCheckPassed:function(e,t){e.aliveCheck={pending:!1,error:!1,complete:!0,success:!0,result:t.payload,object:null}},aliveCheckFailed:function(e,t){e.aliveCheck={pending:!1,error:!0,complete:!0,success:!1,result:t.payload,object:null}}}}),le=ue.actions,de=le.aliveCheckPending,fe=le.aliveCheckPassed,me=le.aliveCheckFailed,pe=ue.reducer,be=Object(C.c)({name:"usCasesByCounty",initialState:{pending:null,error:null,complete:null,success:null,result:null,object:null,progress:null},reducers:{requestPending:function(e,t){e.pending=!0,e.error=null,e.complete=!1,e.success=null,e.result=null,e.object=null,e.progress=t.payload||0},requestSucceeded:function(e,t){e.pending=!1,e.error=!1,e.complete=!0,e.success=!0,e.result=t.payload,e.object=null,e.progress=1},requestFailed:function(e,t){e.pending=!1,e.error=!0,e.complete=!0,e.success=!1,e.result=t.payload,e.object=null,e.progress=null}}}),he=be.actions,ye=he.requestPending,ve=he.requestSucceeded,ge=he.requestFailed,je=be.reducer,Ee=function(){var e=Object(ee.a)($.a.mark((function e(t,a,n){var r;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/us-cases-by-county?startIndex=".concat(t,"&pageSize=").concat(a,"&reverse=").concat(n));case 2:return r=e.sent,e.abrupt("return",r.json());case 4:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),Oe=function(){var e=Object(ee.a)($.a.mark((function e(){var t;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/us-totals");case 2:return t=e.sent,e.abrupt("return",t.json());case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ke=function(){var e=Object(ee.a)($.a.mark((function e(t){var a;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/us-counties?resolution=".concat(t));case 2:return a=e.sent,e.abrupt("return",a.json());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xe=function(){var e=Object(ee.a)($.a.mark((function e(){return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("/api/alive"));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),we=function(e){return function(){var t=Object(ee.a)($.a.mark((function t(a){var n,r;return $.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=[],r={},e.forEach((function(e){var t=parseInt(e.fips);if(isNaN(t))n.push(e);else{var a=parseInt(e.fips);a in r?r[a].push({date:e.date,cases:e.cases,deaths:e.deaths,county:e.county,state:e.state}):r[a]=[{date:e.date,cases:e.cases,deaths:e.deaths,county:e.county,state:e.state}]}})),a(re(r)),a(ce(n));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},Ce=a(42),Se=a.n(Ce);Se.a.accessToken="pk.eyJ1IjoicnVva3ZsIiwiYSI6ImNrZDA3NW9oNTBhanYyeXBjOXBjazloazUifQ.qwtn31dojyeKrFMrcRAjBw";var De=function(e){return function(t,a){var n=Object(f.findLast)(t,(function(e){return e.date<=a})),r=Object(f.findLast)(t,(function(t){return t.date<=e}));return{firstCase:Object(f.get)(t,[1,"date"])===a,hotspot:parseInt(Object(f.get)(n,"cases",0))/parseInt(Object(f.get)(r,"cases",0))>1.2&&parseInt(Object(f.get)(n,"cases",0))>100}}},Ie=function(e,t){var a=Object(f.findLast)(e,(function(e){return e.date<=t}));return{cases:parseInt(Object(f.get)(a,"cases",0)),deaths:parseInt(Object(f.get)(a,"deaths",0))}},Ye=function(e,t,a,n,r,c,o){e.setFeatureState({source:a,sourceLayer:n,id:parseInt(t)},o(r,c))},ze=function(e){var t=e.sources,a=e.activeLayers,c=e.layers,o=e.date,l=e.casesByCounty,f=Object(_.a)(e,["sources","activeLayers","layers","date","casesByCounty"]),m=Object(u.b)(),p=Object(u.c)((function(e){return e.ui.map.hold})),b=Object(u.c)((function(e){return e.ui.map.selectedFeature})),h=Object(u.c)((function(e){return e.request.usCasesByCounty.progress})),y=Object(n.useState)(null),v=Object(i.a)(y,2),g=v[0],j=v[1],E=Object(n.useState)(!1),O=Object(i.a)(E,2),k=O[0],x=O[1],w=Object(n.useState)([]),C=Object(i.a)(w,2),S=C[0],D=C[1],I=Object(n.useRef)(null);Object(n.useEffect)((function(){g&&k&&c.forEach((function(e){g.getLayer(e.id)&&g.setLayoutProperty(e.id,"visibility",a.includes(e.id)?"visible":"none")}))}),[g,k,c,a]),Object(n.useEffect)((function(){var e=new Se.a.Map({container:I.current,style:"mapbox://styles/mapbox/light-v10",center:[-95,39],zoom:3,minZoom:3});j(e)}),[]),Object(n.useEffect)((function(){g&&g.on("load",Object(ee.a)($.a.mark((function e(){var a;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([new Promise((function(e,t){return g.loadImage("/img/coronavirus-green-128.png",(function(a,n){a&&t(a),g.addImage("corona-green",n),e()}))})),new Promise((function(e,t){return g.loadImage("/img/coronavirus-red-128.png",(function(a,n){a&&t(a),g.addImage("corona-red",n),e()}))}))]);case 2:t.forEach((function(e){return g.addSource(e.id,e.config)})),a=function e(){var a=t.reduce((function(e,t){return e&&g.isSourceLoaded(t.id)}),!0);x(a),a&&g.off("sourcedata",e)},g.on("sourcedata",a);case 5:case"end":return e.stop()}}),e)}))))}),[g,t,c]),Object(n.useEffect)((function(){g&&k&&c.forEach((function(e){g.getLayer(e.id)&&g.removeLayer(e.id),g.addLayer(e)}))}),[c,g,k]),Object(n.useEffect)((function(){if(k&&l)for(var e=d()(o).subtract(2,"weeks").format("YYYY-MM-DD"),t=0,a=Object.entries(l);t<a.length;t++){var n=Object(i.a)(a[t],2),r=n[0],c=n[1];Ye(g,r,"us-counties","us-counties-500k-a4l482",c,o,Ie),Ye(g,r,"us-county-centroids",void 0,c,o,De(e))}}),[k,o,l,g]);var Y=Object(n.useCallback)((function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];null!=t&&e.setFeatureState({source:"us-counties",sourceLayer:"us-counties-500k-a4l482",id:t},{active:a,hold:n})}),[]),z=Object(n.useCallback)((function(e,t,a){t!==b&&Y(e,b,!1,a),null!=t&&Y(e,t,!0,a),m(U(t))}),[m,Y,b]),B=Object(n.useCallback)((function(e){if(g&&k){var t=e.features.find((function(e){return"us-counties-base"===e.layer.id}));void 0===t.id?(z(g,null,!1),m(R(!1))):b!==t.id?(z(g,parseInt(t.id),!0),m(R(!0))):(z(g,parseInt(t.id),!p),m(R(!p)))}}),[g,k,p,z,m,b]),F=Object(n.useCallback)((function(e){if(g&&k&&!p){S.slice(0,-1).forEach((function(e){return Y(g,e,!1)}));var t=Object(s.a)(S.slice(-1));if(D(t),e.features.length>0){var a=e.features.find((function(e){return"us-counties-base"===e.layer.id}));D(t.concat([parseInt(a.id)])),z(g,parseInt(a.id))}}}),[g,k,p,S,D,z,Y]),M=Object(n.useCallback)((function(){g&&k&&!p&&z(g,null)}),[g,k,p,z]);return Object(n.useEffect)((function(){return g&&k&&(g.on("mouseup","us-counties-base",B),g.on("mousemove","us-counties-base",F),g.on("mouseleave","us-counties-base",M)),function(){g&&k&&(g.off("mouseup","us-counties-base",B),g.off("mousemove","us-counties-base",F),g.off("mouseleave","us-counties-base",M))}}),[g,k,B,F,M]),r.a.createElement(r.a.Fragment,null,(!k||0===h)&&r.a.createElement("div",{style:{position:"absolute",top:"50%",margin:"0 auto",zIndex:10,width:"100%",textAlign:"center",fontSize:"2em",textShadow:"0px 0px 2px #00e"}},"Rendering visualization..."),r.a.createElement("div",Object.assign({ref:I},f)))};function Be(){var e=Object(p.a)(["\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n"]);return Be=function(){return e},e}var Fe=Object(b.a)(ze)(Be()),Me=[{id:"us-counties",config:{type:"vector",url:"mapbox://ruokvl.0761cl0n",promoteId:"FEATURE_ID"}},{id:"us-county-centroids",config:{type:"geojson",data:"/api/us-county-centroids"}}],Le=[{legend:{label:"Deaths",icon:j.j},id:"us-county-total-deaths",type:"fill",source:"us-counties","source-layer":"us-counties-500k-a4l482",paint:{"fill-color":"#f00","fill-opacity":["interpolate",["linear"],["feature-state","deaths"],0,0,1,.1,10,.2,100,.4,1e3,.7,2e3,.8,1e7,.8]}},{legend:{label:"Cases",icon:j.c},id:"us-county-total-cases",type:"fill",source:"us-counties","source-layer":"us-counties-500k-a4l482",paint:{"fill-color":"#00f","fill-opacity":["interpolate",["linear"],["feature-state","cases"],0,0,10,.1,100,.2,1e4,.4,1e5,.7,2e5,.8,1e7,.8]}},{id:"us-counties-base",type:"fill",source:"us-counties","source-layer":"us-counties-500k-a4l482",paint:{"fill-color":"transparent"}},{id:"us-counties-outline-base",type:"line",source:"us-counties","source-layer":"us-counties-500k-a4l482",paint:{"line-color":["case",["feature-state","hold"],"#0f0","#e842dc"],"line-width":["interpolate",["linear"],["zoom"],3,2,10,4],"line-opacity":["to-number",["feature-state","active"]]}},{legend:{label:"Hotspots",icon:j.l},id:"us-hotspots",type:"symbol",source:"us-county-centroids",layout:{"icon-image":"corona-red","icon-size":["interpolate",["linear"],["zoom"],3,.1,20,1],"icon-ignore-placement":!0},paint:{"icon-opacity":["to-number",["feature-state","hotspot"]],"icon-color":"red"}},{legend:{label:"Onset",icon:j.k},id:"us-first-case",type:"symbol",source:"us-county-centroids",layout:{"icon-image":"corona-green","icon-size":["interpolate",["linear"],["zoom"],3,.3,20,1],"icon-ignore-placement":!0},paint:{"icon-opacity":["to-number",["feature-state","firstCase"]],"icon-color":"red"}},{id:"us-county-names",type:"symbol",source:"us-county-centroids",minzoom:7,layout:{"text-field":["get","NAME"],"text-ignore-placement":!0},paint:{"text-halo-color":"#fff","text-halo-width":1}}];var Ae=function(){var e=Object(u.b)(),t=Object(u.c)((function(e){return e.core.apiServerStatus.aliveCheck})),a=Object(u.c)((function(e){return d()(e.core.time.current,"x")})),c=Object(u.c)((function(e){return e.core.usCovidData.totals})),o=Object(u.c)((function(e){return e.ui.map.selectedFeature})),l=Object(u.c)((function(e){return e.core.usCovidData.casesByCounty})),p=Object(n.useState)(Le.map((function(e){return e.id}))),b=Object(i.a)(p,2),h=b[0],y=b[1],g=Object(n.useState)(!1),j=Object(i.a)(g,2),E=j[0],O=j[1],k=Object(n.useCallback)((function(e){O(e)}),[]),w=Object(n.useCallback)((function(e){var t=h.includes(e);y(t?h.filter((function(t){return t!==e})):[].concat(Object(s.a)(h),[e]))}),[h]);Object(n.useEffect)((function(){e(function(){var e=Object(ee.a)($.a.mark((function e(t){var a,n,r,c,o,s,i,u,l;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!1,n=0,r=1e3,t(de()),e.prev=4,e.next=7,xe();case 7:if(!(c=e.sent).ok){e.next=18;break}return e.t0=t,e.t1=fe,e.next=13,c.text();case 13:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),(0,e.t0)(e.t3),e.next=19;break;case 18:t(me(c.error(c.error())));case 19:e.next=24;break;case 21:e.prev=21,e.t4=e.catch(4),t(me(e.t4));case 24:return o=Oe(),e.next=27,ke("20m");case 27:return s=e.sent,i={},s.features.forEach((function(e){i[parseInt(e.properties.FEATURE_ID)]=[{date:"2020-01-01",cases:0,deaths:0,county:e.properties.NAME,state:e.properties.STATE}]})),t(oe(i)),e.t5=t,e.t6=se,e.next=35,o;case 35:e.t7=e.sent,e.t8=(0,e.t6)(e.t7),(0,e.t5)(e.t8),e.prev=38,t(ye(0));case 40:if(a){e.next=52;break}return e.next=43,Ee(n,r,!0);case 43:u=e.sent,l=u.data||u,t(we(l)),a=l.length<r,n+=r,r*=2,a||t(ye(n/Object(f.get)(u,"meta.totalCount",NaN))),e.next=40;break;case 52:t(ve()),e.next=58;break;case 55:e.prev=55,e.t9=e.catch(38),t(ge(e.t9));case 58:case"end":return e.stop()}}),e,null,[[4,21],[38,55]])})));return function(t){return e.apply(this,arguments)}}())}),[e]);var C=Object(n.useCallback)((function(t){e(Y(t))}),[e]),S=o?{displayName:"".concat(Object(f.get)(Object(f.last)(l[o]),"county"),", ").concat(Object(f.get)(Object(f.last)(l[o]),"state")),data:l[o]}:{displayName:"United States of America",data:c};return t.success?r.a.createElement(r.a.Fragment,null,r.a.createElement(x,{layers:Le,activeLayers:h,updateActiveLayers:w,date:d()(a),onSetDate:C,onShowAbout:function(){return k(!0)},detailsData:S}),r.a.createElement(Fe,{date:a.format("YYYY-MM-DD"),sources:Me,layers:Le,activeLayers:h,casesByCounty:l}),E?r.a.createElement(m.c,{position:"absolute",zIndex:100},r.a.createElement(v,{onHide:function(){return k(!1)}})):null):r.a.createElement(X,{status:t})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ne=a(14),Pe=Object(Ne.c)({usCovidData:ie,time:F,apiServerStatus:pe}),Te=Object(Ne.c)({map:H}),We=Object(Ne.c)({usCasesByCounty:je}),Re=Object(Ne.c)({core:Pe,ui:Te,request:We});var qe=function(e){var t={reducer:Re,middleware:Object(s.a)(Object(C.d)({serializableCheck:!1,immutableCheck:!1})),preloadedState:e,enhancers:[]};return Object(C.a)(t)}();qe.dispatch((function(e){return window.requestAnimationFrame((function(t){return e(function e(t,a){return function(n,r){var c=r().core.time,o=100;c.pause||(o=0,a||(a=t),n(z(t-a))),window.requestAnimationFrame((function(a){return setTimeout((function(){return n(e(a,t))}),o)}))}}(t))}))})),o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(u.a,{store:qe},r.a.createElement(Ae,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[104,1,2]]]);
//# sourceMappingURL=main.6ca7d2b2.chunk.js.map