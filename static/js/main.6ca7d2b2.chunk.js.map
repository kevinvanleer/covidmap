{"version":3,"sources":["components/presentation/Link.js","components/structural/About.js","components/presentation/FloatingPanel.js","components/presentation/ToggleButton.js","components/structural/ControlPanel.js","state/core/time.js","components/structural/DateSelector.js","components/structural/Stats.js","components/core/d3AreaChart.js","state/ui/map.js","components/structural/Details.js","components/presentation/LayerItem.js","components/structural/Layers.js","components/structural/DrawerButton.js","components/structural/AliveStatusWait.js","state/core/usCovidData.js","state/core/apiServerStatus.js","state/request/usCasesByCounty.js","workflows/fetchCovidData.js","components/core/Map.js","components/presentation/FullscreenMap.js","mapboxConfig.js","App.js","serviceWorker.js","services/time.js","state/core/index.js","state/ui/index.js","state/request/index.js","state/rootReducer.js","index.js","state/configureAppStore.js"],"names":["Link","styled","a","props","color","defaultProps","About","onHide","flexDirection","backgroundColor","padding","maxWidth","margin","fontSize","height","href","id","onClick","FloatingPanel","Flexbox","zIndex","ToggleButton","icon","active","fixedWidth","ControlPanel","layers","activeLayers","updateActiveLayers","detailsData","onShowAbout","onSetDate","date","useState","collapsed","setCollapsed","hideLayers","setHideLayers","hideDetails","setHideDetails","width","right","top","alignItems","nowrap","flexGrow","marginBetween","faLayerGroup","faChartBar","horizontal","moment","entity","setDate","withChart","faInfoCircle","updateCurrentTime","createAsyncThunk","timestamp","previous","dispatch","time","getState","core","delay","pause","tick","window","requestAnimationFrame","next","setTimeout","timeSlice","createSlice","name","initialState","min","parseInt","format","max","subtract","current","rate","reducers","setCurrent","state","action","payload","newTime","togglePlayPause","setMax","setMin","setRate","setPause","actions","DateSelector","useDispatch","timeState","useSelector","onChange","value","faPlay","faPause","Stats","deathRate","recentData","newCases","ongoingCases","Intl","NumberFormat","get","twoWeek","toFixed","AreaChart","data","currentDate","currentValue","showIntercept","d3svg","useRef","yTicks","casesData","Object","assign","slice","map","cases","deaths","y","useEffect","svg","d3","selectAll","remove","x","domain","range","yc","Math","last","nice","curve","areaC","d","y0","y1","areaM","append","datum","attr","call","g","ticks","tickFormat","tickSizeOuter","select","clone","text","isEmpty","style","className","role","ref","pointerEvents","mapSlice","hold","selectedFeature","releaseHold","setHold","setSelectedFeature","Details","ui","fourWeek","eightWeek","findLast","status","yesterday","twoWeekLagData","fourWeekLagData","eightWeekLagData","set","closeStats","useCallback","inline","bold","displayName","faFlagUsa","undefined","LayerItem","config","label","toLowerCase","size","Layers","flexWrap","wrapMargin","layer","legend","key","includes","DrawerButton","faPlusSquare","faMinusSquare","AliveStatusWait","position","bottom","left","centerAlign","error","usCovidDataSlice","totals","casesByCounty","badRecords","load","addBoundaries","addBoundary","boundary","properties","FEATURE_ID","county","NAME","STATE","insertStatus","entries","forEach","statusArray","appendStatus","appendBadRecords","setTotals","apiServerStatusSlice","aliveCheck","pending","complete","success","result","object","aliveCheckPending","aliveCheckPassed","aliveCheckFailed","usCasesByCountySlice","progress","requestPending","requestSucceeded","requestFailed","fetchUsCasesByCounty","startIndex","pageSize","reverse","fetch","response","json","fetchUsTotals","fetchUsCovidBoundaries","resolution","fetchAliveCheck","sortCasesByCounty","newStatus","countyId","fips","isNaN","push","mapboxgl","accessToken","centroidState","twoWeeksBefore","twoWeeksPrior","firstCase","hotspot","choroplethState","setFeatureState","featureId","mapSource","sourceLayer","stateFunc","source","MapboxMap","sources","dataProgress","request","usCasesByCounty","setMap","initialized","setInitialized","hoveredFeatures","setHoveredFeatures","mapContainer","getLayer","setLayoutProperty","Map","container","center","zoom","minZoom","on","Promise","all","resolve","reject","loadImage","image","addImage","addSource","detectLoadedSources","init","reduce","loaded","isSourceLoaded","off","removeLayer","addLayer","twoWeeksAgo","selectFeature","theMap","selected","selectNewFeature","onMouseUp","e","theFeature","features","find","feature","onMouseMove","newArray","length","concat","onMouseLeave","textAlign","textShadow","FullscreenMap","type","url","promoteId","faSkullCrossbones","paint","faHeadSideCough","faViruses","layout","faVirus","minzoom","App","aliveStatus","apiServerStatus","usCovidData","setActiveLayers","showAbout","setShowAbout","show","layerId","currentState","filter","item","done","aliveResponse","ok","totalsPromise","boundaries","boundaryStates","usCasesByCountyStatus","NaN","newDate","Boolean","location","hostname","match","combineReducers","store","preloadedState","storeConfig","reducer","rootReducer","middleware","getDefaultMiddleware","serializableCheck","immutableCheck","enhancers","configureStore","configureAppStore","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","console","message"],"mappings":"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","file":"static/js/main.6ca7d2b2.chunk.js","sourcesContent":["import styled from 'styled-components';\n\nexport const Link = styled.a`\n  color: ${(props) => props.color};\n  text-decoration: none;\n\n  &:visited {\n    color: ${(props) => props.color};\n  }\n\n  &:hover {\n    color: cyan;\n  }\n\n  &:active {\n    color: #1790a7;\n  }\n\n  &:focus {\n    color: cyan;\n  }\n`;\n\nLink.defaultProps = {\n  color: '#38c9e4',\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Flexbox, Spacer, Text, Button } from 'kvl-ui';\n\nimport { Link } from '../presentation/Link';\n\nexport const About = ({ onHide }) => (\n  <Flexbox\n    flexDirection=\"column\"\n    backgroundColor=\"#444\"\n    color=\"#eee\"\n    padding=\"1em\"\n    maxWidth=\"80ch\"\n    margin=\"1em\"\n  >\n    <Text fontSize=\"heading\">About this visualization</Text>\n    <Spacer height=\"0.5em\" />\n    <Text>\n      COVID-19 cases and deaths are displayed as blue and red choropleths as\n      reported by the New York Times. Onset, the date of the first case in each\n      county are represented by green icons. Hotspots are displays as red icons.\n      The geographic visuals are rendered with MapBox. The charts are built with\n      D3.\n    </Text>\n    <Spacer height=\"1em\" />\n    <Text fontSize=\"label\">Statistics explained</Text>\n    <Spacer height=\"0.2em\" />\n    <Text>\n      Hotspots are those counties that have at least 100 cases and in which\n      total cases have increased 20% in the past two weeks.\n    </Text>\n    <Spacer height=\"0.3em\" />\n    <Text>\n      New cases are those reported on most recent day for the county, typically\n      yesterday.\n    </Text>\n    <Spacer height=\"0.3em\" />\n    <Text>\n      Ongoing cases is an estimate represented by cases reported within the past\n      two weeks.\n    </Text>\n    <Spacer height=\"0.3em\" />\n    <Text>\n      Death rate compares the current number of deaths to the total number of\n      cases two weeks prior.\n    </Text>\n    <Spacer height=\"1em\" />\n    <Text fontSize=\"label\">Data sources</Text>\n    <Spacer height=\"0.5em\" />\n    <Text>US 2010 census county boundaries</Text>\n    <Link href=\"https://eric.clst.org/tech/usgeojson/\">\n      <Text fontSize=\"detail\">https://eric.clst.org/tech/usgeojson/</Text>\n    </Link>\n    <Spacer height=\"0.5em\" />\n    <Text>New York Times COVID-19 US county-level historic data</Text>\n    <Link href=\"https://github.com/nytimes/covid-19-data\">\n      <Text fontSize=\"detail\">https://github.com/nytimes/covid-19-data</Text>\n    </Link>\n    <Spacer height=\"0.5em\" />\n    <Text>Source code</Text>\n    <Link href=\"https://github.com/kevinvanleer/covidmap\">\n      <Text fontSize=\"detail\">https://github.com/kevinvanleer/covidmap</Text>\n    </Link>\n    <Link href=\"https://github.com/kevinvanleer/coviddata\">\n      <Text fontSize=\"detail\">https://github.com/kevinvanleer/coviddata</Text>\n    </Link>\n    <Spacer height=\"0.5em\" />\n    <Text fontSize=\"detail\">\n      Assembled by Kevin Van Leer. Feedback welcome at:\n    </Text>\n    <Link href=\"mailto:kevin.vanleer@gmail.com\">kevin.vanleer@gmail.com</Link>\n    <Spacer height=\"1em\" />\n    <Button id=\"covidmap-about-hide-self\" onClick={onHide}>\n      <Text color=\"#eee\">Dismiss</Text>\n    </Button>\n  </Flexbox>\n);\n\nAbout.propTypes = { onHide: PropTypes.func };\n","import styled from 'styled-components';\nimport { Flexbox } from 'kvl-ui';\n\nexport const FloatingPanel = styled(Flexbox)`\n  position: absolute;\n`;\n\nFloatingPanel.defaultProps = {\n  zIndex: 10,\n  flexDirection: 'column',\n  backgroundColor: '#444',\n  color: '#eee',\n  padding: '1em',\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { SquareButton } from 'kvl-ui';\n\nexport const ToggleButton = ({ id, onClick, icon, active }) => (\n  <SquareButton\n    id={id}\n    onClick={onClick}\n    backgroundColor={active ? '#777' : '#333'}\n  >\n    <FontAwesomeIcon icon={icon} color={active ? '#eee' : '#777'} fixedWidth />\n  </SquareButton>\n);\n\nToggleButton.propTypes = {\n  id: PropTypes.string,\n  onClick: PropTypes.func,\n  icon: PropTypes.object,\n  active: PropTypes.bool,\n};\n","import React, { useState } from 'react';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faInfoCircle,\n  faLayerGroup,\n  faChartBar,\n} from '@fortawesome/free-solid-svg-icons';\nimport { Flexbox, Spacer, Text, SquareButton, Divider } from 'kvl-ui';\nimport { Details, Layers, DateSelector, DrawerButton } from '.';\nimport { FloatingPanel } from '../presentation/FloatingPanel';\nimport { ToggleButton } from '../presentation/ToggleButton';\n\nexport const ControlPanel = ({\n  layers,\n  activeLayers,\n  updateActiveLayers,\n  detailsData,\n  onShowAbout,\n  onSetDate,\n  date,\n}) => {\n  const [collapsed, setCollapsed] = useState(false);\n  const [hideLayers, setHideLayers] = useState(false);\n  const [hideDetails, setHideDetails] = useState(false);\n  return (\n    <FloatingPanel\n      width=\"min-content\"\n      right=\"1em\"\n      top=\"1em\"\n      backgroundColor=\"rgba(68,68,68,0.85)\"\n      zIndex={100}\n    >\n      <Flexbox alignItems=\"center\">\n        <Text nowrap fontSize=\"heading\">\n          COVID-19\n        </Text>\n        <Spacer width=\"1em\" flexGrow={1} />\n        <Flexbox marginBetween=\"0.2em\" alignItems=\"center\">\n          <ToggleButton\n            id=\"button-covidmap-control-panel-hide-layers\"\n            flexGrow={0}\n            onClick={() => setHideLayers(!hideLayers)}\n            icon={faLayerGroup}\n            active={!hideLayers}\n            backgroundColor=\"#777\"\n          />\n          <ToggleButton\n            id=\"button-covidmap-control-panel-hide-details\"\n            flexGrow={0}\n            onClick={() => setHideDetails(!hideDetails)}\n            icon={faChartBar}\n            active={!hideDetails}\n            backgroundColor=\"#777\"\n          />\n          <DrawerButton\n            id=\"button-covidmap-control-panel-collapse\"\n            flexGrow={0}\n            color=\"white\"\n            onClick={() => setCollapsed(!collapsed)}\n            collapsed={collapsed}\n            backgroundColor=\"#777\"\n          />\n        </Flexbox>\n      </Flexbox>\n      <Divider horizontal margin=\"0.5em 0\" />\n      {!hideLayers ? (\n        <>\n          <Layers\n            layers={layers}\n            activeLayers={activeLayers}\n            updateActiveLayers={updateActiveLayers}\n            collapsed={collapsed}\n          />\n          <Divider horizontal margin=\"1em 0 0.5em 0\" />\n        </>\n      ) : null}\n      {!hideDetails ? (\n        <Details\n          date={moment(date)}\n          entity={detailsData}\n          collapsed={collapsed}\n        />\n      ) : null}\n      <DateSelector date={date} setDate={onSetDate} withChart={!hideDetails} />\n      <Flexbox>\n        <Spacer flexGrow={1} />\n        {!collapsed ? (\n          <>\n            <Spacer height=\"1em\" />\n            <SquareButton\n              id=\"covidmap-show-about-box\"\n              onClick={onShowAbout}\n              backgroundColor=\"#777\"\n            >\n              <FontAwesomeIcon color=\"#eee\" icon={faInfoCircle} />\n            </SquareButton>\n          </>\n        ) : null}\n      </Flexbox>\n    </FloatingPanel>\n  );\n};\n\nControlPanel.propTypes = {\n  layers: PropTypes.array,\n  activeLayers: PropTypes.array,\n  updateActiveLayers: PropTypes.func,\n  detailsData: PropTypes.object,\n  onShowAbout: PropTypes.func,\n  onSetDate: PropTypes.func,\n  date: PropTypes.object,\n};\n","import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport moment from 'moment';\n\nconst updateCurrentTime = createAsyncThunk(\n  'time/updateCurrentTime',\n  ({ timestamp, previous }, { dispatch, getState }) => {\n    const state = getState();\n    const time = state.core.time;\n    let delay = 100;\n    if (!time.pause) {\n      delay = 0;\n      if (!previous) {\n        previous = timestamp;\n      }\n      dispatch(tick(timestamp - previous));\n    }\n\n    window.requestAnimationFrame((next) =>\n      setTimeout(() => dispatch(updateCurrentTime(next, timestamp)), delay)\n    );\n  }\n);\n\nexport const start = createAsyncThunk('time/startPlayback', ({ dispatch }) =>\n  window.requestAnimationFrame((timestamp) =>\n    dispatch(updateCurrentTime(timestamp))\n  )\n);\n\nconst timeSlice = createSlice({\n  name: 'time',\n  initialState: {\n    min: parseInt(moment('2020-01-01').format('x')),\n    max: parseInt(moment().subtract(1, 'days').format('x')),\n    current: parseInt(moment().subtract(1, 'days').format('x')),\n    pause: true,\n    rate: 0,\n  },\n  reducers: {\n    setCurrent: (state, action) => {\n      state.current = parseInt(action.payload);\n    },\n    tick: (state, action) => {\n      let newTime;\n      if (state.current >= state.max) {\n        newTime = state.min;\n      } else {\n        newTime = state.current + action.payload * state.rate;\n        if (newTime > state.max) {\n          newTime = state.max;\n          //delay = 1000;\n        }\n      }\n      state.current = newTime;\n    },\n    togglePlayPause: (state, action) => {\n      state.pause = !state.pause;\n      state.rate = state.pause ? 0 : 864000;\n    },\n    setMax: (state, action) => {\n      state.max = action.payload;\n    },\n    setMin: (state, action) => {\n      state.min = action.payload;\n    },\n    setRate: (state, action) => {\n      state.rate = action.payload;\n    },\n    setPause: (state, action) => {\n      state.pause = action.pause;\n    },\n  },\n});\n\nexport const {\n  setCurrent,\n  tick,\n  setMax,\n  setMin,\n  setRate,\n  setPause,\n  togglePlayPause,\n} = timeSlice.actions;\nexport default timeSlice.reducer;\n","import React from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport Slider from 'rc-slider';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faPlay, faPause } from '@fortawesome/free-solid-svg-icons';\nimport 'rc-slider/assets/index.css';\n\nimport { Text, Flexbox, SquareButton, Spacer } from 'kvl-ui';\nimport { togglePlayPause } from '../../state/core/time.js';\n\nexport const DateSelector = ({ date, setDate, withChart }) => {\n  const dispatch = useDispatch();\n  const timeState = useSelector((state) => state.core.time);\n  return (\n    <Flexbox margin={withChart ? '0 0 0 30px' : '0'} flexDirection=\"column\">\n      <Slider\n        min={timeState.min}\n        max={timeState.max}\n        onChange={(value) => {\n          setDate(value);\n        }}\n        value={timeState.current}\n      />\n      <Flexbox>\n        <SquareButton\n          id=\"button-legend-play-pause\"\n          onClick={() => dispatch(togglePlayPause())}\n          backgroundColor=\"#777\"\n        >\n          <FontAwesomeIcon\n            color=\"#eee\"\n            icon={timeState.rate === 0 ? faPlay : faPause}\n          />\n        </SquareButton>\n        <Spacer flexGrow={1} />\n        <Text>{moment(timeState.current, 'x').format('YYYY-MM-DD')}</Text>\n      </Flexbox>\n    </Flexbox>\n  );\n};\n\nDateSelector.propTypes = {\n  date: PropTypes.object,\n  setDate: PropTypes.func,\n  withChart: PropTypes.bool,\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { get } from 'lodash';\nimport { Text } from 'kvl-ui';\n\nexport const Stats = ({\n  collapsed,\n  entity,\n  deathRate,\n  recentData,\n  newCases,\n  ongoingCases,\n}) => {\n  return !collapsed ? (\n    <>\n      <Text>{`Total cases: ${new Intl.NumberFormat('en-US').format(\n        get(recentData, 'cases', 0)\n      )}`}</Text>\n      <Text>{`Total deaths: ${new Intl.NumberFormat('en-US').format(\n        get(recentData, 'deaths', 0)\n      )}`}</Text>\n      <Text>{`New cases: ${new Intl.NumberFormat('en-US').format(\n        newCases\n      )}`}</Text>\n      <Text>{`Ongoing cases: ${new Intl.NumberFormat('en-US').format(\n        ongoingCases\n      )}`}</Text>\n      <Text>{`Death rate: ${(deathRate.twoWeek * 100).toFixed()}%`}</Text>\n    </>\n  ) : null;\n};\n\nStats.propTypes = {\n  collapsed: PropTypes.bool,\n  entity: PropTypes.object,\n  deathRate: PropTypes.object,\n  recentData: PropTypes.object,\n  newCases: PropTypes.number,\n  ongoingCases: PropTypes.number,\n};\n","import React, { useEffect, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport * as d3 from 'd3';\nimport moment from 'moment';\nimport { last, get, isEmpty } from 'lodash';\n\nconst AreaChart = ({\n  height,\n  data,\n  currentDate,\n  currentValue,\n  showIntercept,\n}) => {\n  const d3svg = useRef(null);\n  const width = 300;\n\n  const yTicks = height * (7 / 200);\n\n  const casesData = Object.assign(\n    data.slice(1).map(({ date, cases, deaths }) => ({\n      date: moment(date),\n      cases: cases,\n      deaths: deaths,\n    })),\n    { y: 'Cases' }\n  );\n\n  useEffect(() => {\n    const margin = { top: 20, right: 0, bottom: 30, left: 30 };\n    if (data && d3svg.current) {\n      let svg = d3.select(d3svg.current);\n      svg.selectAll('*').remove();\n      let x = d3\n        .scaleTime()\n        //.domain(d3.extent(casesData, (d) => d.date))\n        .domain([\n          moment('2020-01-01', 'YYYY-MM-DD'),\n          moment().subtract(1, 'days'),\n        ])\n        .range([margin.left, width - margin.right]);\n\n      let yc = d3\n        .scaleLinear()\n        .domain([0, Math.max(get(last(casesData), 'cases', 0), 10)])\n        .nice()\n        .range([height - margin.bottom, margin.top]);\n\n      /*\n      let ym = d3\n        .scaleLinear()\n        .domain([0, last(mortalityData).value])\n        .nice()\n        .range([height - margin.bottom, margin.top]);\n        */\n\n      let xAxis = (g) =>\n        g\n          .attr('transform', `translate(0,${height - margin.bottom})`)\n          .call(\n            d3\n              .axisBottom(x)\n              .ticks(5)\n              .tickFormat(d3.timeFormat('%b'))\n              .tickSizeOuter(0)\n          );\n\n      let ycAxis = (g) =>\n        g\n          .attr('transform', `translate(${margin.left},0)`)\n          .call(d3.axisLeft(yc).ticks(yTicks, 's'))\n          .call((g) => g.select('.domain').remove())\n          .call((g) =>\n            g\n              .select('.tick:last-of-type text')\n              .clone()\n              .attr('x', 3)\n              .attr('text-anchor', 'start')\n              .attr('font-weight', 'bold')\n              .text(casesData.y)\n          );\n      /*\n      let ymAxis = (g) =>\n        g\n          .attr('transform', `translate(${width - margin.right},0)`)\n          .call(d3.axisRight(ym))\n          .call((g) => g.select('.domain').remove())\n          .call((g) =>\n            g\n              .select('.tick:last-of-type text')\n              .clone()\n              .attr('x', 3)\n              .attr('text-anchor', 'start')\n              .attr('font-weight', 'bold')\n              .text(mortalityData.y)\n          );\n          */\n\n      let curve = d3.curveStep;\n      let areaC = d3\n        .area()\n        .curve(curve)\n        .x((d) => x(d.date))\n        .y0(yc(0))\n        .y1((d) => yc(d.cases));\n      let areaM = d3\n        .area()\n        .curve(curve)\n        .x((d) => x(d.date))\n        .y0(yc(0))\n        .y1((d) => yc(d.deaths));\n\n      svg\n        .append('path')\n        .datum(casesData)\n        .attr('fill', 'steelblue')\n        .attr('d', areaC);\n      svg.append('path').datum(casesData).attr('fill', 'red').attr('d', areaM);\n      svg.append('g').call(xAxis);\n      svg.append('g').call(ycAxis);\n      //svg.append('g').call(ymAxis);\n\n      const radius = 2;\n      const markerColor = '#ccc';\n      if (!isEmpty(data)) {\n        svg\n          .append('line')\n          .attr('x1', x(currentDate))\n          .attr('x2', x(currentDate))\n          .attr('y1', height - margin.bottom)\n          .attr('y2', yc(currentValue) + radius)\n          .style('stroke-width', 1)\n          .style('stroke', markerColor)\n          .style('fill', 'none');\n        svg\n          .append('circle')\n          .attr('cx', x(currentDate))\n          .attr('cy', yc(currentValue))\n          .attr('r', radius)\n          .style('stroke-width', 1)\n          .style('stroke', markerColor)\n          .style('fill', 'none');\n      }\n\n      if (showIntercept && casesData[0]) {\n        svg\n          .append('line')\n          .attr('x1', x(casesData[0].date))\n          .attr('x2', x(casesData[0].date))\n          .attr('y1', height - margin.bottom)\n          .attr('y2', height / 2)\n          .style('stroke-width', 1)\n          .style('stroke', markerColor)\n          .style('fill', 'none');\n        svg\n          .append('text')\n          .attr('x', x(casesData[0].date))\n          .attr('y', height / 2 - 5)\n          .text(casesData[0].date.format('MMM D'))\n          .attr('text-anchor', 'middle')\n          .attr('font-family', 'sans-serif')\n          .attr('font-size', '10px')\n          .attr('fill', '#eee');\n      }\n      if (isEmpty(data)) {\n        svg\n          .append('text')\n          .attr('x', width / 2)\n          .attr('y', height / 2)\n          .text('No data')\n          .attr('text-anchor', 'middle')\n          .attr('font-family', 'sans-serif')\n          .attr('font-size', '20px')\n          .attr('fill', '#eee');\n      }\n    }\n  }, [\n    data,\n    casesData,\n    height,\n    yTicks,\n    currentDate,\n    currentValue,\n    showIntercept,\n  ]);\n\n  return (\n    <svg\n      className=\"area-chart-container\"\n      width={width}\n      height={height}\n      role=\"img\"\n      ref={d3svg}\n      pointerEvents=\"none\"\n    ></svg>\n  );\n};\n\nAreaChart.propTypes = {\n  height: PropTypes.number,\n  data: PropTypes.array,\n  currentDate: PropTypes.object,\n  currentValue: PropTypes.number,\n  showIntercept: PropTypes.bool,\n};\n\nAreaChart.defaultProps = {\n  height: 200,\n  data: [],\n  currentValue: 0,\n};\n\nexport default AreaChart;\n","import { createSlice } from '@reduxjs/toolkit';\n\nconst mapSlice = createSlice({\n  name: 'map',\n  initialState: { hold: false, selectedFeature: null },\n  reducers: {\n    hold: (state) => {\n      state.hold = true;\n    },\n    releaseHold: (state) => {\n      state.hold = false;\n    },\n    setHold: (state, action) => {\n      state.hold = action.payload;\n    },\n    setSelectedFeature: (state, action) => {\n      state.selectedFeature = action.payload;\n    },\n  },\n});\n\nexport const {\n  setHold,\n  hold,\n  releaseHold,\n  setSelectedFeature,\n} = mapSlice.actions;\nexport default mapSlice.reducer;\n","import React, { useCallback } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport { get, findLast, set, isEmpty } from 'lodash';\nimport { Flexbox, Spacer, Text, SquareButton } from 'kvl-ui';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faFlagUsa } from '@fortawesome/free-solid-svg-icons';\n\nimport { Stats } from './Stats.js';\nimport AreaChart from '../core/d3AreaChart.js';\n\nimport { releaseHold, setSelectedFeature } from '../../state/ui/map.js';\n\nexport const Details = ({ date, entity, collapsed }) => {\n  const dispatch = useDispatch();\n  const selectedFeature = useSelector((state) => state.ui.map.selectedFeature);\n  const data = entity.data;\n  let recentData = null;\n  let deathRate = {};\n  let newCases = 0;\n  let ongoingCases = 0;\n\n  if (!isEmpty(data)) {\n    recentData = findLast(\n      data,\n      (status) => status.date <= date.format('YYYY-MM-DD')\n    ) || { deaths: 0, cases: 0 };\n    const yesterday = findLast(\n      data,\n      (status) =>\n        status.date <= moment(date).subtract(1, 'days').format('YYYY-MM-DD')\n    );\n    const twoWeekLagData = findLast(\n      data,\n      (status) =>\n        status.date <= moment(date).subtract(2, 'weeks').format('YYYY-MM-DD')\n    );\n    const fourWeekLagData = findLast(\n      data,\n      (status) =>\n        status.date <= moment(date).subtract(4, 'weeks').format('YYYY-MM-DD')\n    );\n    const eightWeekLagData = findLast(\n      data,\n      (status) =>\n        status.date <= moment(date).subtract(8, 'weeks').format('YYYY-MM-DD')\n    );\n    set(deathRate, 'current', recentData.deaths / recentData.cases);\n    set(\n      deathRate,\n      'twoWeek',\n      recentData.deaths / get(twoWeekLagData, 'cases') || 0\n    );\n    set(\n      deathRate,\n      'fourWeek',\n      recentData.deaths / get(fourWeekLagData, 'cases') || 0\n    );\n    set(\n      deathRate,\n      'eightWeek',\n      recentData.deaths / get(eightWeekLagData, 'cases') || 0\n    );\n    newCases = get(recentData, 'cases', 0) - get(yesterday, 'cases', 0);\n    ongoingCases =\n      get(recentData, 'cases', 0) - get(twoWeekLagData, 'cases', 0);\n  } else {\n    recentData = {\n      date: '2020-01-01',\n      cases: 0,\n      deaths: 0,\n    };\n    deathRate = {\n      current: 0,\n      twoWeek: 0,\n      fourWeek: 0,\n      eightWeek: 0,\n    };\n  }\n\n  const closeStats = useCallback(() => {\n    dispatch(releaseHold());\n    dispatch(setSelectedFeature(null));\n  }, [dispatch]);\n\n  return recentData ? (\n    <Flexbox flexDirection=\"column\">\n      <Flexbox inline>\n        <Flexbox flexDirection=\"column\">\n          <Text bold fontSize=\"label\">\n            {entity.displayName}\n          </Text>\n          <Text fontSize=\"detail\">{`reporting on ${recentData.date}`}</Text>\n          <Spacer height=\"0.5em\" />\n          <Stats\n            deathRate={deathRate}\n            collapsed={collapsed}\n            entity={entity}\n            recentData={recentData}\n            newCases={newCases}\n            ongoingCases={ongoingCases}\n          />\n        </Flexbox>\n        <Spacer flexGrow={1} />\n        {selectedFeature != null ? (\n          <SquareButton\n            id=\"covid19-button-close-stats\"\n            onClick={closeStats}\n            backgroundColor=\"#777\"\n          >\n            <FontAwesomeIcon color=\"#eee\" icon={faFlagUsa} fixedWidth />\n          </SquareButton>\n        ) : null}\n      </Flexbox>\n      <AreaChart\n        data={data}\n        currentDate={date}\n        height={collapsed ? 100 : undefined}\n        currentValue={parseInt(get(recentData, 'cases', 0))}\n        showIntercept={true}\n      />\n    </Flexbox>\n  ) : null;\n};\n\nDetails.propTypes = {\n  date: PropTypes.object,\n  entity: PropTypes.object,\n  collapsed: PropTypes.bool,\n};\n","import React from 'react';\nimport styled from 'styled-components';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { Flexbox, Spacer, Text, SquareButton } from 'kvl-ui';\n\nexport const LayerItem = styled(\n  ({ className, onClick, config, active, collapsed }) => (\n    <Flexbox alignItems=\"center\" onClick={onClick}>\n      <SquareButton\n        id={`covidmap-button-layer-item-${config.label.toLowerCase()}`}\n        onClick={onClick}\n        backgroundColor={active ? '#777' : '#333'}\n      >\n        <FontAwesomeIcon\n          size={collapsed ? 'sm' : 'lg'}\n          icon={config.icon}\n          color={active ? '#eee' : '#777'}\n          fixedWidth\n        />\n      </SquareButton>\n      {!collapsed ? (\n        <>\n          <Spacer width=\"0.5em\" />\n          <Text fontSize=\"label\" bold={active} className={className}>\n            {config.label}\n          </Text>\n        </>\n      ) : null}\n    </Flexbox>\n  )\n)`\n  cursor: pointer;\n`;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Flexbox, Text, Spacer } from 'kvl-ui';\n\nimport { LayerItem } from '../presentation/LayerItem.js';\n\nexport const Layers = ({\n  layers,\n  activeLayers,\n  updateActiveLayers,\n  collapsed,\n}) => (\n  <Flexbox flexDirection=\"column\">\n    {!collapsed ? (\n      <>\n        <Text bold fontSize=\"label\">\n          Layers\n        </Text>\n        <Spacer height=\"0.5em\" />\n      </>\n    ) : null}\n    <Flexbox flexWrap=\"wrap\" wrapMargin=\"0.5em\">\n      {layers.map((layer) =>\n        layer.legend === undefined ? null : (\n          <LayerItem\n            key={layer.id}\n            onClick={() => updateActiveLayers(layer.id)}\n            config={layer.legend}\n            active={activeLayers.includes(layer.id)}\n            collapsed={collapsed}\n          />\n        )\n      )}\n    </Flexbox>\n  </Flexbox>\n);\n\nLayers.propTypes = {\n  layers: PropTypes.array,\n  activeLayers: PropTypes.array,\n  updateActiveLayers: PropTypes.func,\n  collapsed: PropTypes.bool,\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faMinusSquare, faPlusSquare } from '@fortawesome/free-solid-svg-icons';\nimport { SquareButton } from 'kvl-ui';\n\nexport const DrawerButton = ({ collapsed, ...props }) => (\n  <SquareButton {...props}>\n    <FontAwesomeIcon\n      color=\"#eee\"\n      icon={collapsed ? faPlusSquare : faMinusSquare}\n      fixedWidth\n    />\n  </SquareButton>\n);\n\nDrawerButton.propTypes = {\n  collapsed: PropTypes.bool,\n  setCollapsed: PropTypes.func,\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Flexbox, Text } from 'kvl-ui';\n\nexport const AliveStatusWait = ({ status }) => (\n  <Flexbox\n    backgroundColor=\"#222\"\n    position=\"absolute\"\n    top=\"0\"\n    bottom=\"0\"\n    left=\"0\"\n    right=\"0\"\n  >\n    <Text\n      position=\"absolute\"\n      margin=\"0 auto\"\n      top=\"50%\"\n      zIndex={100}\n      width=\"100%\"\n      centerAlign\n      fontSize=\"title\"\n      color=\"#eee\"\n    >\n      {status.error\n        ? `API server failed to respond`\n        : `Waiting for API server to wake up...`}\n    </Text>\n  </Flexbox>\n);\n\nAliveStatusWait.propTypes = {\n  status: PropTypes.object,\n};\n","import { createSlice } from '@reduxjs/toolkit';\n\nconst usCovidDataSlice = createSlice({\n  name: 'usCovidData',\n  initialState: { totals: [], casesByCounty: {}, badRecords: [] },\n  reducers: {\n    load: (state, action) => {\n      state.casesByCounty = action.payload;\n    },\n    addBoundaries: (state, action) => {\n      state.casesByCounty = { ...state.casesByCounty, ...action.payload };\n    },\n    addBoundary: (state, action) => {\n      const boundary = action.payload;\n      state.casesByCounty[parseInt(boundary.properties.FEATURE_ID)] = [\n        {\n          date: '2020-01-01',\n          cases: 0,\n          deaths: 0,\n          county: boundary.properties.NAME,\n          state: boundary.properties.STATE,\n        },\n      ];\n    },\n    insertStatus: (state, action) => {\n      Object.entries(action.payload).forEach(([id, statusArray]) => {\n        if (id in state.casesByCounty) {\n          state.casesByCounty[id] = [\n            state.casesByCounty[id][0],\n            ...statusArray,\n            ...state.casesByCounty[id].slice(1),\n          ];\n        } else {\n          state.casesByCounty[id] = statusArray;\n        }\n      });\n    },\n    appendStatus: (state, action) => {\n      Object.entries(action.payload).forEach(([id, statusArray]) => {\n        if (id in state.casesByCounty) {\n          state.casesByCounty[id] = [\n            ...state.casesByCounty[id],\n            ...statusArray,\n          ];\n        } else {\n          state.casesByCounty[id] = statusArray;\n        }\n      });\n    },\n    appendBadRecords: (state, action) => {\n      state.badRecords = action.payload;\n    },\n    setTotals: (state, action) => {\n      state.totals = action.payload.data;\n    },\n  },\n});\n\nexport const {\n  load,\n  appendStatus,\n  insertStatus,\n  appendBadRecords,\n  addBoundary,\n  addBoundaries,\n  setTotals,\n} = usCovidDataSlice.actions;\nexport default usCovidDataSlice.reducer;\n","import { createSlice } from '@reduxjs/toolkit';\n\nconst apiServerStatusSlice = createSlice({\n  name: 'apiServerStatus',\n  initialState: {\n    aliveCheck: {\n      pending: null,\n      error: null,\n      complete: null,\n      success: null,\n      result: null,\n      object: null,\n    },\n  },\n  reducers: {\n    aliveCheckPending: (state) => {\n      state.aliveCheck = {\n        pending: true,\n        error: null,\n        complete: false,\n        success: null,\n        result: null,\n        object: null,\n      };\n    },\n    aliveCheckPassed: (state, action) => {\n      state.aliveCheck = {\n        pending: false,\n        error: false,\n        complete: true,\n        success: true,\n        result: action.payload,\n        object: null,\n      };\n    },\n    aliveCheckFailed: (state, action) => {\n      state.aliveCheck = {\n        pending: false,\n        error: true,\n        complete: true,\n        success: false,\n        result: action.payload,\n        object: null,\n      };\n    },\n  },\n});\n\nexport const {\n  aliveCheckPending,\n  aliveCheckPassed,\n  aliveCheckFailed,\n} = apiServerStatusSlice.actions;\nexport default apiServerStatusSlice.reducer;\n","import { createSlice } from '@reduxjs/toolkit';\n\nconst usCasesByCountySlice = createSlice({\n  name: 'usCasesByCounty',\n  initialState: {\n    pending: null,\n    error: null,\n    complete: null,\n    success: null,\n    result: null,\n    object: null,\n    progress: null,\n  },\n  reducers: {\n    requestPending: (state, action) => {\n      state.pending = true;\n      state.error = null;\n      state.complete = false;\n      state.success = null;\n      state.result = null;\n      state.object = null;\n      state.progress = action.payload || 0;\n    },\n    requestSucceeded: (state, action) => {\n      state.pending = false;\n      state.error = false;\n      state.complete = true;\n      state.success = true;\n      state.result = action.payload;\n      state.object = null;\n      state.progress = 1;\n    },\n    requestFailed: (state, action) => {\n      state.pending = false;\n      state.error = true;\n      state.complete = true;\n      state.success = false;\n      state.result = action.payload;\n      state.object = null;\n      state.progress = null;\n    },\n  },\n});\n\nexport const {\n  requestPending,\n  requestSucceeded,\n  requestFailed,\n} = usCasesByCountySlice.actions;\n\nexport default usCasesByCountySlice.reducer;\n","import { get } from 'lodash';\nimport {\n  addBoundaries,\n  insertStatus,\n  appendBadRecords,\n  setTotals,\n} from '../state/core/usCovidData.js';\nimport {\n  aliveCheckPending,\n  aliveCheckPassed,\n  aliveCheckFailed,\n} from '../state/core/apiServerStatus.js';\n\nimport * as usCasesByCountyStatus from '../state/request/usCasesByCounty.js';\n\nexport const fetchUsCasesByCounty = async (startIndex, pageSize, reverse) => {\n  const response = await fetch(\n    `/api/us-cases-by-county?startIndex=${startIndex}&pageSize=${pageSize}&reverse=${reverse}`\n  );\n  return response.json();\n};\n\nexport const fetchUsTotals = async () => {\n  const response = await fetch(`/api/us-totals`);\n  return response.json();\n};\n\nexport const fetchUsCovidBoundaries = async (resolution) => {\n  const response = await fetch(`/api/us-counties?resolution=${resolution}`);\n  return response.json();\n};\n\nexport const fetchAliveCheck = async () => {\n  return fetch(`/api/alive`);\n};\n\nconst sortCasesByCounty = (newCases) => async (dispatch) => {\n  let badRecords = [];\n  let newStatus = {};\n\n  newCases.forEach((status) => {\n    const countyId = parseInt(status.fips);\n\n    if (isNaN(countyId)) {\n      badRecords.push(status);\n    } else {\n      const countyId = parseInt(status.fips);\n\n      if (countyId in newStatus) {\n        newStatus[countyId].push({\n          date: status.date,\n          cases: status.cases,\n          deaths: status.deaths,\n          county: status.county,\n          state: status.state,\n        });\n      } else {\n        newStatus[countyId] = [\n          {\n            date: status.date,\n            cases: status.cases,\n            deaths: status.deaths,\n            county: status.county,\n            state: status.state,\n          },\n        ];\n      }\n    }\n  });\n\n  dispatch(insertStatus(newStatus));\n  dispatch(appendBadRecords(badRecords));\n};\n\nexport const initializeFeatureState = () => async (dispatch) => {\n  let done = false;\n  let startIndex = 0;\n  let pageSize = 1000;\n\n  dispatch(aliveCheckPending());\n  try {\n    const aliveResponse = await fetchAliveCheck();\n    if (aliveResponse.ok) {\n      dispatch(aliveCheckPassed(await aliveResponse.text()));\n    } else {\n      dispatch(aliveCheckFailed(aliveResponse.error(aliveResponse.error())));\n    }\n  } catch (e) {\n    dispatch(aliveCheckFailed(e));\n  }\n\n  const totalsPromise = fetchUsTotals();\n\n  const boundaries = await fetchUsCovidBoundaries('20m');\n  const boundaryStates = {};\n  boundaries.features.forEach((boundary) => {\n    boundaryStates[parseInt(boundary.properties.FEATURE_ID)] = [\n      {\n        date: '2020-01-01',\n        cases: 0,\n        deaths: 0,\n        county: boundary.properties.NAME,\n        state: boundary.properties.STATE,\n      },\n    ];\n  });\n  dispatch(addBoundaries(boundaryStates));\n  dispatch(setTotals(await totalsPromise));\n\n  try {\n    dispatch(usCasesByCountyStatus.requestPending(0));\n    while (!done) {\n      const newCases = await fetchUsCasesByCounty(startIndex, pageSize, true);\n      const data = newCases.data || newCases;\n      dispatch(sortCasesByCounty(data));\n      done = data.length < pageSize;\n      startIndex += pageSize;\n      pageSize *= 2;\n      if (!done) {\n        dispatch(\n          usCasesByCountyStatus.requestPending(\n            startIndex / get(newCases, 'meta.totalCount', NaN)\n          )\n        );\n      }\n    }\n    dispatch(usCasesByCountyStatus.requestSucceeded());\n  } catch (e) {\n    dispatch(usCasesByCountyStatus.requestFailed(e));\n  }\n};\n","import React, { useState, useCallback, useEffect, useRef } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport mapboxgl from 'mapbox-gl';\nimport { findLast, get } from 'lodash';\n\nimport { setHold, setSelectedFeature } from '../../state/ui/map.js';\n\nmapboxgl.accessToken =\n  'pk.eyJ1IjoicnVva3ZsIiwiYSI6ImNrZDA3NW9oNTBhanYyeXBjOXBjazloazUifQ.qwtn31dojyeKrFMrcRAjBw';\n\nconst centroidState = (twoWeeksBefore) => (state, date) => {\n  const recentData = findLast(state, (status) => status.date <= date);\n  const twoWeeksPrior = findLast(\n    state,\n    (status) => status.date <= twoWeeksBefore\n  );\n  return {\n    firstCase: get(state, [1, 'date']) === date,\n    hotspot:\n      parseInt(get(recentData, 'cases', 0)) /\n        parseInt(get(twoWeeksPrior, 'cases', 0)) >\n        1.2 && parseInt(get(recentData, 'cases', 0)) > 100,\n  };\n};\n\nconst choroplethState = (state, date) => {\n  const recentData = findLast(state, (status) => status.date <= date);\n  return {\n    cases: parseInt(get(recentData, 'cases', 0)),\n    deaths: parseInt(get(recentData, 'deaths', 0)),\n  };\n};\n\nconst setFeatureState = (\n  map,\n  featureId,\n  mapSource,\n  sourceLayer,\n  state,\n  date,\n  stateFunc\n) => {\n  map.setFeatureState(\n    {\n      source: mapSource,\n      sourceLayer: sourceLayer,\n      id: parseInt(featureId),\n    },\n    stateFunc(state, date)\n  );\n};\n\nconst MapboxMap = ({\n  sources,\n  activeLayers,\n  layers,\n  date,\n  casesByCounty,\n  ...props\n}) => {\n  const dispatch = useDispatch();\n  const hold = useSelector((state) => state.ui.map.hold);\n  const selectedFeature = useSelector((state) => state.ui.map.selectedFeature);\n  const dataProgress = useSelector(\n    (state) => state.request.usCasesByCounty.progress\n  );\n  const [map, setMap] = useState(null);\n  const [initialized, setInitialized] = useState(false);\n  const [hoveredFeatures, setHoveredFeatures] = useState([]);\n  const mapContainer = useRef(null);\n\n  useEffect(() => {\n    if (map && initialized) {\n      layers.forEach((layer) => {\n        if (map.getLayer(layer.id)) {\n          map.setLayoutProperty(\n            layer.id,\n            'visibility',\n            activeLayers.includes(layer.id) ? 'visible' : 'none'\n          );\n        }\n      });\n    }\n  }, [map, initialized, layers, activeLayers]);\n\n  useEffect(() => {\n    const lat = 39;\n    const lng = -95;\n    const zoom = 3;\n\n    const map = new mapboxgl.Map({\n      container: mapContainer.current,\n      style: 'mapbox://styles/mapbox/light-v10',\n      center: [lng, lat],\n      zoom: zoom,\n      minZoom: 3,\n    });\n    setMap(map);\n  }, []);\n\n  useEffect(() => {\n    if (map) {\n      map.on('load', async () => {\n        await Promise.all([\n          new Promise((resolve, reject) =>\n            map.loadImage('/img/coronavirus-green-128.png', (error, image) => {\n              if (error) reject(error);\n              map.addImage('corona-green', image);\n              resolve();\n            })\n          ),\n          new Promise((resolve, reject) =>\n            map.loadImage('/img/coronavirus-red-128.png', (error, image) => {\n              if (error) reject(error);\n              map.addImage('corona-red', image);\n              resolve();\n            })\n          ),\n        ]);\n\n        sources.forEach((source) => map.addSource(source.id, source.config));\n        const detectLoadedSources = () => {\n          const init = sources.reduce(\n            (loaded, source) => loaded && map.isSourceLoaded(source.id),\n            true\n          );\n          setInitialized(init);\n          if (init) map.off('sourcedata', detectLoadedSources);\n        };\n        map.on('sourcedata', detectLoadedSources);\n      });\n    }\n  }, [map, sources, layers]);\n\n  useEffect(() => {\n    if (map && initialized) {\n      layers.forEach((layer) => {\n        if (map.getLayer(layer.id)) map.removeLayer(layer.id);\n        map.addLayer(layer);\n      });\n    }\n  }, [layers, map, initialized]);\n\n  useEffect(() => {\n    if (initialized && casesByCounty) {\n      const twoWeeksAgo = moment(date)\n        .subtract(2, 'weeks')\n        .format('YYYY-MM-DD');\n      for (const [key, value] of Object.entries(casesByCounty)) {\n        setFeatureState(\n          map,\n          key,\n          'us-counties',\n          'us-counties-500k-a4l482',\n          value,\n          date,\n          choroplethState\n        );\n        setFeatureState(\n          map,\n          key,\n          'us-county-centroids',\n          undefined,\n          value,\n          date,\n          centroidState(twoWeeksAgo)\n        );\n      }\n    }\n  }, [initialized, date, casesByCounty, map]);\n\n  const selectFeature = useCallback(\n    (theMap, featureId, selected, hold = false) => {\n      if (featureId != null) {\n        theMap.setFeatureState(\n          {\n            source: 'us-counties',\n            sourceLayer: 'us-counties-500k-a4l482',\n            id: featureId,\n          },\n          { active: selected, hold }\n        );\n      }\n    },\n    []\n  );\n\n  const selectNewFeature = useCallback(\n    (theMap, featureId, hold) => {\n      if (featureId !== selectedFeature) {\n        selectFeature(theMap, selectedFeature, false, hold);\n      }\n      if (featureId != null) {\n        selectFeature(theMap, featureId, true, hold);\n      }\n      dispatch(setSelectedFeature(featureId));\n    },\n    [dispatch, selectFeature, selectedFeature]\n  );\n\n  const onMouseUp = useCallback(\n    (e) => {\n      if (map && initialized) {\n        const theFeature = e.features.find(\n          (feature) => feature.layer.id === 'us-counties-base'\n        );\n        if (theFeature.id === undefined) {\n          selectNewFeature(map, null, false);\n          dispatch(setHold(false));\n        } else if (selectedFeature !== theFeature.id) {\n          selectNewFeature(map, parseInt(theFeature.id), true);\n          dispatch(setHold(true));\n        } else {\n          selectNewFeature(map, parseInt(theFeature.id), !hold);\n          dispatch(setHold(!hold));\n        }\n      }\n    },\n    [map, initialized, hold, selectNewFeature, dispatch, selectedFeature]\n  );\n\n  const onMouseMove = useCallback(\n    (e) => {\n      if (map && initialized && !hold) {\n        let removeFeatures = hoveredFeatures.slice(0, -1);\n        removeFeatures.forEach((feature) => selectFeature(map, feature, false));\n        let newArray = [...hoveredFeatures.slice(-1)];\n        setHoveredFeatures(newArray);\n        if (e.features.length > 0) {\n          const theFeature = e.features.find(\n            (feature) => feature.layer.id === 'us-counties-base'\n          );\n          setHoveredFeatures(newArray.concat([parseInt(theFeature.id)]));\n          selectNewFeature(map, parseInt(theFeature.id));\n        }\n      }\n    },\n    [\n      map,\n      initialized,\n      hold,\n      hoveredFeatures,\n      setHoveredFeatures,\n      selectNewFeature,\n      selectFeature,\n    ]\n  );\n\n  const onMouseLeave = useCallback(() => {\n    if (map && initialized && !hold) {\n      selectNewFeature(map, null);\n    }\n  }, [map, initialized, hold, selectNewFeature]);\n\n  useEffect(() => {\n    if (map && initialized) {\n      map.on('mouseup', 'us-counties-base', onMouseUp);\n      map.on('mousemove', 'us-counties-base', onMouseMove);\n      map.on('mouseleave', 'us-counties-base', onMouseLeave);\n    }\n    return () => {\n      if (map && initialized) {\n        map.off('mouseup', 'us-counties-base', onMouseUp);\n        map.off('mousemove', 'us-counties-base', onMouseMove);\n        map.off('mouseleave', 'us-counties-base', onMouseLeave);\n      }\n    };\n  }, [map, initialized, onMouseUp, onMouseMove, onMouseLeave]);\n\n  return (\n    <>\n      {(!initialized || dataProgress === 0) && (\n        <div\n          style={{\n            position: 'absolute',\n            top: '50%',\n            margin: '0 auto',\n            zIndex: 10,\n            width: '100%',\n            textAlign: 'center',\n            fontSize: '2em',\n            textShadow: '0px 0px 2px #00e',\n          }}\n        >\n          Rendering visualization...\n        </div>\n      )}\n      <div ref={mapContainer} {...props} />\n    </>\n  );\n};\n\nMapboxMap.propTypes = {\n  activeLayers: PropTypes.array,\n  sources: PropTypes.array,\n  layers: PropTypes.array,\n  date: PropTypes.string,\n  casesByCounty: PropTypes.object,\n};\n\nexport default MapboxMap;\n","import styled from 'styled-components';\nimport Map from '../core/Map.js';\n\nconst FullscreenMap = styled(Map)`\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n`;\n\nexport default FullscreenMap;\n","import {\n  faSkullCrossbones,\n  faVirus,\n  faViruses,\n  faHeadSideCough,\n} from '@fortawesome/free-solid-svg-icons';\n\nexport const sources = [\n  {\n    id: 'us-counties',\n    config: {\n      type: 'vector',\n      url: 'mapbox://ruokvl.0761cl0n',\n      promoteId: 'FEATURE_ID',\n    },\n  },\n  {\n    id: 'us-county-centroids',\n    config: {\n      type: 'geojson',\n      data: '/api/us-county-centroids',\n    },\n  },\n];\nexport const layers = [\n  {\n    legend: {\n      label: 'Deaths',\n      icon: faSkullCrossbones,\n    },\n    id: 'us-county-total-deaths',\n    type: 'fill',\n    source: 'us-counties',\n    'source-layer': 'us-counties-500k-a4l482',\n    paint: {\n      'fill-color': '#f00',\n      'fill-opacity': [\n        'interpolate',\n        ['linear'],\n        ['feature-state', 'deaths'],\n        0,\n        0,\n        1,\n        0.1,\n        10,\n        0.2,\n        100,\n        0.4,\n        1000,\n        0.7,\n        2000,\n        0.8,\n        10000000,\n        0.8,\n      ],\n    },\n  },\n  {\n    legend: {\n      label: 'Cases',\n      icon: faHeadSideCough,\n    },\n    id: 'us-county-total-cases',\n    type: 'fill',\n    source: 'us-counties',\n    'source-layer': 'us-counties-500k-a4l482',\n    paint: {\n      'fill-color': '#00f',\n      'fill-opacity': [\n        'interpolate',\n        ['linear'],\n        ['feature-state', 'cases'],\n        0,\n        0,\n        10,\n        0.1,\n        100,\n        0.2,\n        10000,\n        0.4,\n        100000,\n        0.7,\n        200000,\n        0.8,\n        10000000,\n        0.8,\n      ],\n    },\n  },\n  {\n    id: 'us-counties-base',\n    type: 'fill',\n    source: 'us-counties',\n    'source-layer': 'us-counties-500k-a4l482',\n    paint: {\n      'fill-color': 'transparent',\n    },\n  },\n  {\n    id: 'us-counties-outline-base',\n    type: 'line',\n    source: 'us-counties',\n    'source-layer': 'us-counties-500k-a4l482',\n    paint: {\n      'line-color': ['case', ['feature-state', 'hold'], '#0f0', '#e842dc'],\n      'line-width': ['interpolate', ['linear'], ['zoom'], 3, 2, 10, 4],\n      'line-opacity': ['to-number', ['feature-state', 'active']],\n    },\n  },\n  {\n    legend: {\n      label: 'Hotspots',\n      icon: faViruses,\n    },\n    id: 'us-hotspots',\n    type: 'symbol',\n    source: 'us-county-centroids',\n    layout: {\n      'icon-image': 'corona-red',\n      'icon-size': ['interpolate', ['linear'], ['zoom'], 3, 0.1, 20, 1],\n      'icon-ignore-placement': true,\n    },\n    paint: {\n      'icon-opacity': ['to-number', ['feature-state', 'hotspot']],\n      'icon-color': 'red',\n    },\n  },\n  {\n    legend: {\n      label: 'Onset',\n      icon: faVirus,\n    },\n    id: 'us-first-case',\n    type: 'symbol',\n    source: 'us-county-centroids',\n    layout: {\n      'icon-image': 'corona-green',\n      'icon-size': ['interpolate', ['linear'], ['zoom'], 3, 0.3, 20, 1],\n      'icon-ignore-placement': true,\n    },\n    paint: {\n      'icon-opacity': ['to-number', ['feature-state', 'firstCase']],\n      'icon-color': 'red',\n    },\n  },\n  {\n    id: 'us-county-names',\n    type: 'symbol',\n    source: 'us-county-centroids',\n    minzoom: 7,\n    layout: { 'text-field': ['get', 'NAME'], 'text-ignore-placement': true },\n    paint: {\n      'text-halo-color': '#fff',\n      'text-halo-width': 1,\n    },\n  },\n];\n","import React, { useEffect, useState, useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport moment from 'moment';\nimport { get, last } from 'lodash';\n\nimport { ControlPanel, About, AliveStatusWait } from './components/structural';\nimport { Flexbox } from 'kvl-ui';\n\nimport { initializeFeatureState } from './workflows/fetchCovidData.js';\n\nimport FullscreenMap from './components/presentation/FullscreenMap.js';\n\nimport { layers, sources } from './mapboxConfig.js';\n\nimport { setCurrent } from './state/core/time.js';\n\nfunction App() {\n  const dispatch = useDispatch();\n  const aliveStatus = useSelector(\n    (state) => state.core.apiServerStatus.aliveCheck\n  );\n  const date = useSelector((state) => moment(state.core.time.current, 'x'));\n  const totals = useSelector((state) => state.core.usCovidData.totals);\n  const selectedFeature = useSelector((state) => state.ui.map.selectedFeature);\n  const casesByCounty = useSelector(\n    (state) => state.core.usCovidData.casesByCounty\n  );\n  const [activeLayers, setActiveLayers] = useState(\n    layers.map((layer) => layer.id)\n  );\n  const [showAbout, setShowAbout] = useState(false);\n\n  const onShowAbout = useCallback((show) => {\n    setShowAbout(show);\n  }, []);\n\n  const updateActiveLayers = useCallback(\n    (layerId) => {\n      const currentState = activeLayers.includes(layerId);\n      setActiveLayers(\n        currentState\n          ? activeLayers.filter((item) => item !== layerId)\n          : [...activeLayers, layerId]\n      );\n    },\n    [activeLayers]\n  );\n\n  useEffect(() => {\n    dispatch(initializeFeatureState());\n  }, [dispatch]);\n\n  const onSetDate = useCallback(\n    (newDate) => {\n      dispatch(setCurrent(newDate));\n    },\n    [dispatch]\n  );\n\n  const detailsData = selectedFeature\n    ? {\n        displayName: `${get(\n          last(casesByCounty[selectedFeature]),\n          'county'\n        )}, ${get(last(casesByCounty[selectedFeature]), 'state')}`,\n        data: casesByCounty[selectedFeature],\n      }\n    : { displayName: 'United States of America', data: totals };\n\n  return aliveStatus.success ? (\n    <>\n      <ControlPanel\n        layers={layers}\n        activeLayers={activeLayers}\n        updateActiveLayers={updateActiveLayers}\n        date={moment(date)}\n        onSetDate={onSetDate}\n        onShowAbout={() => onShowAbout(true)}\n        detailsData={detailsData}\n      />\n      <FullscreenMap\n        date={date.format('YYYY-MM-DD')}\n        sources={sources}\n        layers={layers}\n        activeLayers={activeLayers}\n        casesByCounty={casesByCounty}\n      />\n      {showAbout ? (\n        <Flexbox position=\"absolute\" zIndex={100}>\n          <About onHide={() => onShowAbout(false)} />\n        </Flexbox>\n      ) : null}\n    </>\n  ) : (\n    <AliveStatusWait status={aliveStatus} />\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import { tick } from '../state/core/time.js';\n\nconst updateCurrentTime = (timestamp, previous) => (dispatch, getState) => {\n  const state = getState();\n  const time = state.core.time;\n  let delay = 100;\n  if (!time.pause) {\n    delay = 0;\n    if (!previous) {\n      previous = timestamp;\n    }\n    dispatch(tick(timestamp - previous));\n  }\n\n  window.requestAnimationFrame((next) =>\n    setTimeout(() => dispatch(updateCurrentTime(next, timestamp)), delay)\n  );\n};\n\nexport const start = () => (dispatch) =>\n  window.requestAnimationFrame((timestamp) =>\n    dispatch(updateCurrentTime(timestamp))\n  );\n","import { combineReducers } from '@reduxjs/toolkit';\nimport usCovidData from './usCovidData.js';\nimport time from './time.js';\nimport apiServerStatus from './apiServerStatus.js';\n\nexport default combineReducers({\n  usCovidData,\n  time,\n  apiServerStatus,\n});\n","import { combineReducers } from '@reduxjs/toolkit';\nimport map from './map.js';\n\nexport default combineReducers({\n  map,\n});\n","import { combineReducers } from '@reduxjs/toolkit';\nimport usCasesByCounty from './usCasesByCounty.js';\n\nexport default combineReducers({\n  usCasesByCounty,\n});\n","import { combineReducers } from '@reduxjs/toolkit';\nimport core from './core';\nimport ui from './ui';\nimport request from './request';\n\nexport default combineReducers({\n  core,\n  ui,\n  request,\n});\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport { start as startTimeService } from './services/time.js';\n\nimport { Provider } from 'react-redux';\n\nimport configureAppStore from './state/configureAppStore.js';\n\nconst store = configureAppStore();\n\nstore.dispatch(startTimeService());\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","import { configureStore, getDefaultMiddleware } from '@reduxjs/toolkit';\n\nimport monitorReducersEnhancer from './enhancers/monitorReducer.js';\nimport loggerMiddleware from './middleware/logger.js';\nimport rootReducer from './rootReducer.js';\n\nexport default function configureAppStore(preloadedState) {\n  const storeConfig = {\n    reducer: rootReducer,\n    middleware: [\n      ...getDefaultMiddleware({\n        serializableCheck: false,\n        immutableCheck: false,\n      }),\n    ],\n    preloadedState,\n    enhancers: [],\n  };\n\n  if (process.env.NODE_ENV !== 'production' && module.hot) {\n    module.hot.accept('./core', () => store.replaceReducer(rootReducer));\n    storeConfig.middleware.push(loggerMiddleware);\n    storeConfig.enhancers.push(monitorReducersEnhancer);\n  }\n\n  const store = configureStore(storeConfig);\n\n  return store;\n}\n"],"sourceRoot":""}