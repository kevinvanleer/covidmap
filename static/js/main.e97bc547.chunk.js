(this.webpackJsonpcovidmap=this.webpackJsonpcovidmap||[]).push([[0],{104:function(e,t,a){e.exports=a(126)},109:function(e,t,a){},126:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(9),o=a.n(c),s=(a(109),a(15)),i=a(10),u=a(6),l=a(4),d=a.n(l),f=a(2),m=a(1),p=a(19),b=a(8);function h(){var e=Object(p.a)(["\n  color: ",";\n  text-decoration: none;\n\n  &:visited {\n    color: ",";\n  }\n\n  &:hover {\n    color: cyan;\n  }\n\n  &:active {\n    color: #1790a7;\n  }\n\n  &:focus {\n    color: cyan;\n  }\n"]);return h=function(){return e},e}var y=b.a.a(h(),(function(e){return e.color}),(function(e){return e.color}));y.defaultProps={color:"#38c9e4"};var v=function(e){var t=e.onHide;return r.a.createElement(m.c,{flexDirection:"column",backgroundColor:"#444",color:"#eee",padding:"1em",maxWidth:"80ch",margin:"1em"},r.a.createElement(m.f,{fontSize:"heading"},"About this visualization"),r.a.createElement(m.d,{height:"0.5em"}),r.a.createElement(m.f,null,"COVID-19 cases and deaths are displayed as blue and red choropleths as reported by the New York Times. Onset, the date of the first case in each county are represented by green icons. Hotspots are displays as red icons. The geographic visuals are rendered with MapBox. The charts are built with D3."),r.a.createElement(m.d,{height:"1em"}),r.a.createElement(m.f,{fontSize:"label"},"Statistics explained"),r.a.createElement(m.d,{height:"0.2em"}),r.a.createElement(m.f,null,"Hotspots are those counties that have at least 100 cases and in which total cases have increased 20% in the past two weeks."),r.a.createElement(m.d,{height:"0.3em"}),r.a.createElement(m.f,null,"New cases are those reported on most recent day for the county, typically yesterday."),r.a.createElement(m.d,{height:"0.3em"}),r.a.createElement(m.f,null,"Ongoing cases is an estimate represented by cases reported within the past two weeks."),r.a.createElement(m.d,{height:"1em"}),r.a.createElement(m.f,{fontSize:"label"},"Data sources"),r.a.createElement(m.d,{height:"0.5em"}),r.a.createElement(m.f,null,"US 2010 census county boundaries"),r.a.createElement(y,{href:"https://eric.clst.org/tech/usgeojson/"},r.a.createElement(m.f,{fontSize:"detail"},"https://eric.clst.org/tech/usgeojson/")),r.a.createElement(m.d,{height:"0.5em"}),r.a.createElement(m.f,null,"New York Times COVID-19 US county-level historic data"),r.a.createElement(y,{href:"https://github.com/nytimes/covid-19-data"},r.a.createElement(m.f,{fontSize:"detail"},"https://github.com/nytimes/covid-19-data")),r.a.createElement(m.d,{height:"0.5em"}),r.a.createElement(m.f,null,"Source code"),r.a.createElement(y,{href:"https://github.com/kevinvanleer/covidmap"},r.a.createElement(m.f,{fontSize:"detail"},"https://github.com/kevinvanleer/covidmap")),r.a.createElement(y,{href:"https://github.com/kevinvanleer/coviddata"},r.a.createElement(m.f,{fontSize:"detail"},"https://github.com/kevinvanleer/coviddata")),r.a.createElement(m.d,{height:"0.5em"}),r.a.createElement(m.f,{fontSize:"detail"},"Assembled by Kevin Van Leer. Feedback welcome at:"),r.a.createElement(y,{href:"mailto:kevin.vanleer@gmail.com"},"kevin.vanleer@gmail.com"),r.a.createElement(m.d,{height:"1em"}),r.a.createElement(m.a,{id:"covidmap-about-hide-self",onClick:t},r.a.createElement(m.f,{color:"#eee"},"Dismiss")))},g=a(13),E=a(7);function j(){var e=Object(p.a)(["\n  position: absolute;\n"]);return j=function(){return e},e}var O=Object(b.a)(m.c)(j());O.defaultProps={zIndex:10,flexDirection:"column",backgroundColor:"#444",color:"#eee",padding:"1em"};var k=function(e){var t=e.id,a=e.onClick,n=e.icon,c=e.active;return r.a.createElement(m.e,{id:t,onClick:a,backgroundColor:c?"#777":"#333"},r.a.createElement(g.a,{icon:n,color:c?"#eee":"#777",fixedWidth:!0}))},x=function(e){var t=e.layers,a=e.activeLayers,c=e.updateActiveLayers,o=e.detailsData,s=e.onShowAbout,u=e.onSetDate,l=e.date,f=Object(n.useState)(!1),p=Object(i.a)(f,2),b=p[0],h=p[1],y=Object(n.useState)(!1),v=Object(i.a)(y,2),j=v[0],x=v[1],w=Object(n.useState)(!1),C=Object(i.a)(w,2),S=C[0],D=C[1];return r.a.createElement(O,{width:"min-content",right:"1em",top:"1em",backgroundColor:"rgba(68,68,68,0.85)"},r.a.createElement(m.c,{alignItems:"center"},r.a.createElement(m.f,{nowrap:!0,fontSize:"heading"},"COVID-19"),r.a.createElement(m.d,{width:"1em",flexGrow:1}),r.a.createElement(m.c,{marginBetween:"0.2em",alignItems:"center"},r.a.createElement(k,{id:"button-covidmap-control-panel-hide-layers",flexGrow:0,onClick:function(){return x(!j)},icon:E.e,active:!j,backgroundColor:"#777"}),r.a.createElement(k,{id:"button-covidmap-control-panel-hide-details",flexGrow:0,onClick:function(){return D(!S)},icon:E.a,active:!S,backgroundColor:"#777"}),r.a.createElement(K,{id:"button-covidmap-control-panel-collapse",flexGrow:0,color:"white",onClick:function(){return h(!b)},collapsed:b,backgroundColor:"#777"}))),r.a.createElement(m.b,{horizontal:!0,margin:"0.5em 0"}),j?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(Z,{layers:t,activeLayers:a,updateActiveLayers:c,collapsed:b}),r.a.createElement(m.b,{horizontal:!0,margin:"1em 0 0.5em 0"})),S?null:r.a.createElement(G,{date:d()(l),entity:o,collapsed:b}),r.a.createElement(B,{date:l,setDate:u,withChart:!S}),r.a.createElement(m.c,null,r.a.createElement(m.d,{flexGrow:1}),b?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(m.d,{height:"1em"}),r.a.createElement(m.e,{id:"covidmap-show-about-box",onClick:s,backgroundColor:"#777"},r.a.createElement(g.a,{color:"#eee",icon:E.d})))))},w=a(56),C=(a(124),a(11)),S=Object(C.b)("time/updateCurrentTime",(function(e,t){var a=e.timestamp,n=e.previous,r=t.dispatch,c=(0,t.getState)().core.time,o=100;c.pause||(o=0,n||(n=a),r(z(a-n))),window.requestAnimationFrame((function(e){return setTimeout((function(){return r(S(e,a))}),o)}))})),D=(Object(C.b)("time/startPlayback",(function(e){var t=e.dispatch;return window.requestAnimationFrame((function(e){return t(S(e))}))})),Object(C.c)({name:"time",initialState:{min:parseInt(d()("2020-01-01").format("x")),max:parseInt(d()().subtract(1,"days").format("x")),current:parseInt(d()().subtract(1,"days").format("x")),pause:!0,rate:0},reducers:{setCurrent:function(e,t){e.current=parseInt(t.payload)},tick:function(e,t){var a;e.current>=e.max?a=e.min:(a=e.current+t.payload*e.rate)>e.max&&(a=e.max),e.current=a},togglePlayPause:function(e,t){e.pause=!e.pause,e.rate=e.pause?0:864e3},setMax:function(e,t){e.max=t.payload},setMin:function(e,t){e.min=t.payload},setRate:function(e,t){e.rate=t.payload},setPause:function(e,t){e.pause=t.pause}}})),I=D.actions,Y=I.setCurrent,z=I.tick,F=(I.setMax,I.setMin,I.setRate,I.setPause,I.togglePlayPause),M=D.reducer,B=function(e){e.date;var t=e.setDate,a=e.withChart,n=Object(u.b)(),c=Object(u.c)((function(e){return e.core.time}));return r.a.createElement(m.c,{margin:a?"0 0 0 30px":"0",flexDirection:"column"},r.a.createElement(w.a,{min:c.min,max:c.max,onChange:function(e){t(e)},value:c.current}),r.a.createElement(m.c,null,r.a.createElement(m.e,{id:"button-legend-play-pause",onClick:function(){return n(F())},backgroundColor:"#777"},r.a.createElement(g.a,{color:"#eee",icon:0===c.rate?E.h:E.g})),r.a.createElement(m.d,{flexGrow:1}),r.a.createElement(m.f,null,d()(c.current,"x").format("YYYY-MM-DD"))))},L=function(e){var t=e.collapsed,a=(e.entity,e.deathRate),n=e.recentData,c=e.newCases,o=e.ongoingCases;return t?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(m.f,null,"Total cases: ".concat(new Intl.NumberFormat("en-US").format(Object(f.get)(n,"cases",0)))),r.a.createElement(m.f,null,"Total deaths: ".concat(new Intl.NumberFormat("en-US").format(Object(f.get)(n,"deaths",0)))),r.a.createElement(m.f,null,"New cases: ".concat(new Intl.NumberFormat("en-US").format(c))),r.a.createElement(m.f,null,"Ongoing cases: ".concat(new Intl.NumberFormat("en-US").format(o))),r.a.createElement(m.f,null,"death rate:\n          ".concat((100*a.current).toFixed(),"% /\n          ").concat((100*a.twoWeek).toFixed(),"% /\n          ").concat((100*a.fourWeek).toFixed(),"% /\n          ").concat((100*a.eightWeek).toFixed(),"%")))},A=a(16),N=function(e){var t=e.height,a=e.data,c=e.currentDate,o=e.currentValue,s=e.showIntercept,i=Object(n.useRef)(null),u=.035*t,l=Object.assign(a.slice(1).map((function(e){var t=e.date,a=e.cases,n=e.deaths;return{date:d()(t),cases:a,deaths:n}})),{y:"Cases"});return Object(n.useEffect)((function(){var e=20,n=0,r=30,m=30;if(a&&i.current){var p=A.g(i.current);p.selectAll("*").remove();var b=A.f().domain([d()("2020-01-01","YYYY-MM-DD"),d()().subtract(1,"days")]).range([m,300-n]),h=A.e().domain([0,Math.max(Object(f.get)(Object(f.last)(l),"cases",0),10)]).nice().range([t-r,e]),y=A.d,v=A.a().curve(y).x((function(e){return b(e.date)})).y0(h(0)).y1((function(e){return h(e.cases)})),g=A.a().curve(y).x((function(e){return b(e.date)})).y0(h(0)).y1((function(e){return h(e.deaths)}));p.append("path").datum(l).attr("fill","steelblue").attr("d",v),p.append("path").datum(l).attr("fill","red").attr("d",g),p.append("g").call((function(e){return e.attr("transform","translate(0,".concat(t-r,")")).call(A.b(b).ticks(5).tickFormat(A.h("%b")).tickSizeOuter(0))})),p.append("g").call((function(e){return e.attr("transform","translate(".concat(m,",0)")).call(A.c(h).ticks(u,"s")).call((function(e){return e.select(".domain").remove()})).call((function(e){return e.select(".tick:last-of-type text").clone().attr("x",3).attr("text-anchor","start").attr("font-weight","bold").text(l.y)}))}));Object(f.isEmpty)(a)||(p.append("line").attr("x1",b(c)).attr("x2",b(c)).attr("y1",t-r).attr("y2",h(o)+2).style("stroke-width",1).style("stroke","#ccc").style("fill","none"),p.append("circle").attr("cx",b(c)).attr("cy",h(o)).attr("r",2).style("stroke-width",1).style("stroke","#ccc").style("fill","none")),s&&l[0]&&(p.append("line").attr("x1",b(l[0].date)).attr("x2",b(l[0].date)).attr("y1",t-r).attr("y2",t/2).style("stroke-width",1).style("stroke","#ccc").style("fill","none"),p.append("text").attr("x",b(l[0].date)).attr("y",t/2-5).text(l[0].date.format("MMM D")).attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size","10px").attr("fill","#eee")),Object(f.isEmpty)(a)&&p.append("text").attr("x",150).attr("y",t/2).text("No data").attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size","20px").attr("fill","#eee")}}),[a,l,t,u,c,o,s]),r.a.createElement("svg",{className:"area-chart-container",width:300,height:t,role:"img",ref:i,pointerEvents:"none"})};N.defaultProps={height:200,data:[],currentValue:0};var T=N,W=Object(C.c)({name:"map",initialState:{hold:!1,selectedFeature:null},reducers:{hold:function(e){e.hold=!0},releaseHold:function(e){e.hold=!1},setHold:function(e,t){e.hold=t.payload},setSelectedFeature:function(e,t){e.selectedFeature=t.payload}}}),R=W.actions,P=R.setHold,U=(R.hold,R.releaseHold),H=R.setSelectedFeature,V=W.reducer,G=function(e){var t=e.date,a=e.entity,c=e.collapsed,o=Object(u.b)(),s=Object(u.c)((function(e){return e.ui.map.selectedFeature})),i=a.data,l=null,p={},b=0,h=0;if(Object(f.isEmpty)(i))l={date:"2020-01-01",cases:0,deaths:0},p={current:0,twoWeek:0,fourWeek:0,eightWeek:0};else{l=Object(f.findLast)(i,(function(e){return e.date<=t.format("YYYY-MM-DD")}))||{deaths:0,cases:0};var y=Object(f.findLast)(i,(function(e){return e.date<=d()(t).subtract(1,"days").format("YYYY-MM-DD")})),v=Object(f.findLast)(i,(function(e){return e.date<=d()(t).subtract(2,"weeks").format("YYYY-MM-DD")})),j=Object(f.findLast)(i,(function(e){return e.date<=d()(t).subtract(4,"weeks").format("YYYY-MM-DD")})),O=Object(f.findLast)(i,(function(e){return e.date<=d()(t).subtract(8,"weeks").format("YYYY-MM-DD")}));Object(f.set)(p,"current",l.deaths/l.cases),Object(f.set)(p,"twoWeek",l.deaths/Object(f.get)(v,"cases")||0),Object(f.set)(p,"fourWeek",l.deaths/Object(f.get)(j,"cases")||0),Object(f.set)(p,"eightWeek",l.deaths/Object(f.get)(O,"cases")||0),b=Object(f.get)(l,"cases",0)-Object(f.get)(y,"cases",0),h=Object(f.get)(l,"cases",0)-Object(f.get)(v,"cases",0)}var k=Object(n.useCallback)((function(){o(U()),o(H(null))}),[o]);return l?r.a.createElement(m.c,{flexDirection:"column"},r.a.createElement(m.c,{inline:!0},r.a.createElement(m.c,{flexDirection:"column"},r.a.createElement(m.f,{bold:!0,fontSize:"label"},a.displayName),r.a.createElement(m.f,{fontSize:"detail"},"reporting on ".concat(l.date)),r.a.createElement(m.d,{height:"0.5em"}),r.a.createElement(L,{deathRate:p,collapsed:c,entity:a,recentData:l,newCases:b,ongoingCases:h})),r.a.createElement(m.d,{flexGrow:1}),null!=s?r.a.createElement(m.e,{id:"covid19-button-close-stats",onClick:k,backgroundColor:"#777"},r.a.createElement(g.a,{color:"#eee",icon:E.b,fixedWidth:!0})):null),r.a.createElement(T,{data:i,currentDate:t,height:c?100:void 0,currentValue:parseInt(Object(f.get)(l,"cases",0)),showIntercept:!0})):null};function q(){var e=Object(p.a)(["\n  cursor: pointer;\n"]);return q=function(){return e},e}var J=Object(b.a)((function(e){var t=e.className,a=e.onClick,n=e.config,c=e.active,o=e.collapsed;return r.a.createElement(m.c,{alignItems:"center",onClick:a},r.a.createElement(m.e,{id:"covidmap-button-layer-item-".concat(n.label.toLowerCase()),onClick:a,backgroundColor:c?"#777":"#333"},r.a.createElement(g.a,{size:o?"sm":"lg",icon:n.icon,color:c?"#eee":"#777",fixedWidth:!0})),o?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(m.d,{width:"0.5em"}),r.a.createElement(m.f,{fontSize:"label",bold:c,className:t},n.label)))}))(q()),Z=function(e){var t=e.layers,a=e.activeLayers,n=e.updateActiveLayers,c=e.collapsed;return r.a.createElement(m.c,{flexDirection:"column"},c?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(m.f,{bold:!0,fontSize:"label"},"Layers"),r.a.createElement(m.d,{height:"0.5em"})),r.a.createElement(m.c,{flexWrap:"wrap",wrapMargin:"0.5em"},t.map((function(e){return void 0===e.legend?null:r.a.createElement(J,{key:e.id,onClick:function(){return n(e.id)},config:e.legend,active:a.includes(e.id),collapsed:c})}))))},_=a(34),K=function(e){var t=e.collapsed,a=Object(_.a)(e,["collapsed"]);return r.a.createElement(m.e,a,r.a.createElement(g.a,{color:"#eee",icon:t?E.i:E.f,fixedWidth:!0}))},X=a(12),Q=a.n(X),$=a(20),ee=a(57),te=Object(C.c)({name:"usCovidData",initialState:{totals:[],casesByCounty:{},badRecords:[]},reducers:{load:function(e,t){e.casesByCounty=t.payload},addBoundaries:function(e,t){e.casesByCounty=Object(ee.a)({},e.casesByCounty,{},t.payload)},addBoundary:function(e,t){var a=t.payload;e.casesByCounty[parseInt(a.properties.FEATURE_ID)]=[{date:"2020-01-01",cases:0,deaths:0,county:a.properties.NAME,state:a.properties.STATE}]},insertStatus:function(e,t){Object.entries(t.payload).forEach((function(t){var a=Object(i.a)(t,2),n=a[0],r=a[1];n in e.casesByCounty?e.casesByCounty[n]=[e.casesByCounty[n][0]].concat(Object(s.a)(r),Object(s.a)(e.casesByCounty[n].slice(1))):e.casesByCounty[n]=r}))},appendStatus:function(e,t){Object.entries(t.payload).forEach((function(t){var a=Object(i.a)(t,2),n=a[0],r=a[1];n in e.casesByCounty?e.casesByCounty[n]=[].concat(Object(s.a)(e.casesByCounty[n]),Object(s.a)(r)):e.casesByCounty[n]=r}))},appendBadRecords:function(e,t){e.badRecords=t.payload},setTotals:function(e,t){e.totals=t.payload.data}}}),ae=te.actions,ne=(ae.load,ae.appendStatus,ae.insertStatus),re=ae.appendBadRecords,ce=(ae.addBoundary,ae.addBoundaries),oe=ae.setTotals,se=te.reducer,ie=function(){var e=Object($.a)(Q.a.mark((function e(t,a,n){var r;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/us-cases-by-county?startIndex=".concat(t,"&pageSize=").concat(a,"&reverse=").concat(n));case 2:return r=e.sent,e.abrupt("return",r.json());case 4:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),ue=function(){var e=Object($.a)(Q.a.mark((function e(){var t;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/us-totals");case 2:return t=e.sent,e.abrupt("return",t.json());case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),le=function(){var e=Object($.a)(Q.a.mark((function e(t){var a;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/us-counties?resolution=".concat(t));case 2:return a=e.sent,e.abrupt("return",a.json());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),de=function(e){return function(){var t=Object($.a)(Q.a.mark((function t(a){var n,r;return Q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=[],r={},e.forEach((function(e){var t=parseInt(e.fips);if(isNaN(t))n.push(e);else{var a=parseInt(e.fips);a in r?r[a].push({date:e.date,cases:e.cases,deaths:e.deaths,county:e.county,state:e.state}):r[a]=[{date:e.date,cases:e.cases,deaths:e.deaths,county:e.county,state:e.state}]}})),a(ne(r)),a(re(n));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},fe=a(42),me=a.n(fe);me.a.accessToken="pk.eyJ1IjoicnVva3ZsIiwiYSI6ImNrZDA3NW9oNTBhanYyeXBjOXBjazloazUifQ.qwtn31dojyeKrFMrcRAjBw";var pe=function(e){return function(t,a){var n=Object(f.findLast)(t,(function(e){return e.date<=a})),r=Object(f.findLast)(t,(function(t){return t.date<=e}));return{firstCase:Object(f.get)(t,[1,"date"])===a,hotspot:parseInt(Object(f.get)(n,"cases",0))/parseInt(Object(f.get)(r,"cases",0))>1.2&&parseInt(Object(f.get)(n,"cases",0))>100}}},be=function(e,t){var a=Object(f.findLast)(e,(function(e){return e.date<=t}));return{cases:parseInt(Object(f.get)(a,"cases",0)),deaths:parseInt(Object(f.get)(a,"deaths",0))}},he=function(e,t,a,n,r,c,o){e.setFeatureState({source:a,sourceLayer:n,id:parseInt(t)},o(r,c))},ye=function(e){var t=e.sources,a=e.activeLayers,c=e.layers,o=e.date,l=e.casesByCounty,f=Object(_.a)(e,["sources","activeLayers","layers","date","casesByCounty"]),m=Object(u.b)(),p=Object(u.c)((function(e){return e.ui.map.hold})),b=Object(u.c)((function(e){return e.ui.map.selectedFeature})),h=Object(n.useState)(null),y=Object(i.a)(h,2),v=y[0],g=y[1],E=Object(n.useState)(!1),j=Object(i.a)(E,2),O=j[0],k=j[1],x=Object(n.useState)([]),w=Object(i.a)(x,2),C=w[0],S=w[1],D=Object(n.useRef)(null);Object(n.useEffect)((function(){v&&O&&c.forEach((function(e){v.getLayer(e.id)&&v.setLayoutProperty(e.id,"visibility",a.includes(e.id)?"visible":"none")}))}),[v,O,c,a]),Object(n.useEffect)((function(){var e=new me.a.Map({container:D.current,style:"mapbox://styles/mapbox/light-v10",center:[-95,39],zoom:3,minZoom:3});g(e)}),[]),Object(n.useEffect)((function(){v&&v.on("load",Object($.a)(Q.a.mark((function e(){var a;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([new Promise((function(e,t){return v.loadImage("/img/coronavirus-green-128.png",(function(a,n){a&&t(a),v.addImage("corona-green",n),e()}))})),new Promise((function(e,t){return v.loadImage("/img/coronavirus-red-128.png",(function(a,n){a&&t(a),v.addImage("corona-red",n),e()}))}))]);case 2:t.forEach((function(e){return v.addSource(e.id,e.config)})),a=function e(){var a=t.reduce((function(e,t){return e&&v.isSourceLoaded(t.id)}),!0);k(a),a&&v.off("sourcedata",e)},v.on("sourcedata",a);case 5:case"end":return e.stop()}}),e)}))))}),[v,t,c]),Object(n.useEffect)((function(){v&&O&&c.forEach((function(e){v.getLayer(e.id)&&v.removeLayer(e.id),v.addLayer(e)}))}),[c,v,O]),Object(n.useEffect)((function(){if(O&&l)for(var e=d()(o).subtract(2,"weeks").format("YYYY-MM-DD"),t=0,a=Object.entries(l);t<a.length;t++){var n=Object(i.a)(a[t],2),r=n[0],c=n[1];he(v,r,"us-counties","us-counties-500k-a4l482",c,o,be),he(v,r,"us-county-centroids",void 0,c,o,pe(e))}}),[O,o,l,v]);var I=Object(n.useCallback)((function(e,t,a){null!=t&&e.setFeatureState({source:"us-counties",sourceLayer:"us-counties-500k-a4l482",id:t},{active:a})}),[]),Y=Object(n.useCallback)((function(e,t){t!==b&&I(e,b,!1),null!=t&&I(e,t,!0),m(H(t))}),[m,I,b]),z=Object(n.useCallback)((function(e){if(v&&O){var t=e.features.find((function(e){return"us-counties-base"===e.layer.id}));void 0===t.id?(Y(v,null),m(P(!1))):b!==t.id?(Y(v,parseInt(t.id)),m(P(!0))):m(P(!p))}}),[v,O,p,Y,m,b]),F=Object(n.useCallback)((function(e){if(v&&O&&!p){C.slice(0,-1).forEach((function(e){return I(v,e,!1)}));var t=Object(s.a)(C.slice(-1));if(S(t),e.features.length>0){var a=e.features.find((function(e){return"us-counties-base"===e.layer.id}));S(t.concat([parseInt(a.id)])),Y(v,parseInt(a.id))}}}),[v,O,p,C,S,Y,I]),M=Object(n.useCallback)((function(){v&&O&&!p&&Y(v,null)}),[v,O,p,Y]);return Object(n.useEffect)((function(){return v&&O&&(v.on("mouseup","us-counties-base",z),v.on("mousemove","us-counties-base",F),v.on("mouseleave","us-counties-base",M)),function(){v&&O&&(v.off("mouseup","us-counties-base",z),v.off("mousemove","us-counties-base",F),v.off("mouseleave","us-counties-base",M))}}),[v,O,z,F,M]),r.a.createElement(r.a.Fragment,null,!O&&r.a.createElement("div",{style:{position:"absolute",top:"50%",margin:"0 auto",zIndex:100,width:"100%",textAlign:"center",fontSize:"2em",textShadow:"0px 0px 2px #00e"}},"Rendering visualization..."),r.a.createElement("div",Object.assign({ref:D},f)))};function ve(){var e=Object(p.a)(["\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n"]);return ve=function(){return e},e}var ge=Object(b.a)(ye)(ve()),Ee=[{id:"us-counties",config:{type:"vector",url:"mapbox://ruokvl.0761cl0n",promoteId:"FEATURE_ID"}},{id:"us-county-centroids",config:{type:"geojson",data:"/api/us-county-centroids"}}],je=[{legend:{label:"Deaths",icon:E.j},id:"us-county-total-deaths",type:"fill",source:"us-counties","source-layer":"us-counties-500k-a4l482",paint:{"fill-color":"#f00","fill-opacity":["interpolate",["linear"],["feature-state","deaths"],0,0,1,.1,10,.2,100,.4,1e3,.7,2e3,.8,1e7,.8]}},{legend:{label:"Cases",icon:E.c},id:"us-county-total-cases",type:"fill",source:"us-counties","source-layer":"us-counties-500k-a4l482",paint:{"fill-color":"#00f","fill-opacity":["interpolate",["linear"],["feature-state","cases"],0,0,10,.1,100,.2,1e4,.4,1e5,.7,2e5,.8,1e7,.8]}},{id:"us-counties-base",type:"fill",source:"us-counties","source-layer":"us-counties-500k-a4l482",paint:{"fill-color":"transparent"}},{id:"us-counties-outline-base",type:"line",source:"us-counties","source-layer":"us-counties-500k-a4l482",paint:{"line-color":"#e842dc","line-width":["interpolate",["linear"],["zoom"],3,2,10,4],"line-opacity":["to-number",["feature-state","active"]]}},{legend:{label:"Hotspots",icon:E.l},id:"us-hotspots",type:"symbol",source:"us-county-centroids",layout:{"icon-image":"corona-red","icon-size":["interpolate",["linear"],["zoom"],3,.1,20,1],"icon-ignore-placement":!0},paint:{"icon-opacity":["to-number",["feature-state","hotspot"]],"icon-color":"red"}},{legend:{label:"Onset",icon:E.k},id:"us-first-case",type:"symbol",source:"us-county-centroids",layout:{"icon-image":"corona-green","icon-size":["interpolate",["linear"],["zoom"],3,.3,20,1],"icon-ignore-placement":!0},paint:{"icon-opacity":["to-number",["feature-state","firstCase"]],"icon-color":"red"}},{id:"us-county-names",type:"symbol",source:"us-county-centroids",minzoom:7,layout:{"text-field":["get","NAME"],"text-ignore-placement":!0},paint:{"text-halo-color":"#fff","text-halo-width":1}}];var Oe=function(){var e=Object(u.b)(),t=Object(u.c)((function(e){return d()(e.core.time.current,"x")})),a=Object(u.c)((function(e){return e.core.usCovidData.totals})),c=Object(u.c)((function(e){return e.ui.map.selectedFeature})),o=Object(u.c)((function(e){return e.core.usCovidData.casesByCounty})),l=Object(n.useState)(je.map((function(e){return e.id}))),p=Object(i.a)(l,2),b=p[0],h=p[1],y=Object(n.useState)(!1),g=Object(i.a)(y,2),E=g[0],j=g[1],O=Object(n.useCallback)((function(e){j(e)}),[]),k=Object(n.useCallback)((function(e){var t=b.includes(e);h(t?b.filter((function(t){return t!==e})):[].concat(Object(s.a)(b),[e]))}),[b]);Object(n.useEffect)((function(){e(function(){var e=Object($.a)(Q.a.mark((function e(t){var a,n,r,c,o,s,i;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!1,n=0,r=1e3,c=ue(),e.next=6,le("20m");case 6:return o=e.sent,s={},o.features.forEach((function(e){s[parseInt(e.properties.FEATURE_ID)]=[{date:"2020-01-01",cases:0,deaths:0,county:e.properties.NAME,state:e.properties.STATE}]})),t(ce(s)),e.t0=t,e.t1=oe,e.next=14,c;case 14:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),(0,e.t0)(e.t3);case 17:if(a){e.next=27;break}return e.next=20,ie(n,r,!0);case 20:i=e.sent,t(de(i)),a=i.length<r,n+=r,r*=2,e.next=17;break;case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[e]);var w=Object(n.useCallback)((function(t){e(Y(t))}),[e]),C=c?{displayName:"".concat(Object(f.get)(Object(f.last)(o[c]),"county"),", ").concat(Object(f.get)(Object(f.last)(o[c]),"state")),data:o[c]}:{displayName:"United States of America",data:a};return r.a.createElement(r.a.Fragment,null,r.a.createElement(x,{layers:je,activeLayers:b,updateActiveLayers:k,date:d()(t),onSetDate:w,onShowAbout:function(){return O(!0)},detailsData:C}),r.a.createElement(ge,{date:t.format("YYYY-MM-DD"),sources:Ee,layers:je,activeLayers:b,casesByCounty:o}),E?r.a.createElement(m.c,{position:"absolute",zIndex:10},r.a.createElement(v,{onHide:function(){return O(!1)}})):null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ke=a(14),xe=Object(ke.c)({usCovidData:se,time:M}),we=Object(ke.c)({map:V}),Ce=Object(ke.c)({core:xe,ui:we});var Se=function(e){var t={reducer:Ce,middleware:Object(s.a)(Object(C.d)({serializableCheck:!1,immutableCheck:!1})),preloadedState:e,enhancers:[]};return Object(C.a)(t)}();Se.dispatch((function(e){return window.requestAnimationFrame((function(t){return e(function e(t,a){return function(n,r){var c=r().core.time,o=100;c.pause||(o=0,a||(a=t),n(z(t-a))),window.requestAnimationFrame((function(a){return setTimeout((function(){return n(e(a,t))}),o)}))}}(t))}))})),o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(u.a,{store:Se},r.a.createElement(Oe,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[104,1,2]]]);
//# sourceMappingURL=main.e97bc547.chunk.js.map